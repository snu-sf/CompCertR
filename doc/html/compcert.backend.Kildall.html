
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Kildall</title>
<meta name="description" content="Documentation of Coq module Kildall" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Kildall</h1>
<div class="coq">
<br/>
<div class="doc">Solvers for dataflow inequations. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Coqlib.html">Coqlib</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Iteration.html">Iteration</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Maps.html">Maps</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Lattice.html">Lattice</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Unset</span> <span class="id">Elimination</span> <span class="id">Schemes</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Unset</span> <span class="id">Case</span> <span class="id">Analysis</span> <span class="id">Schemes</span>.<br/>
<br/>
<div class="doc">A forward dataflow problem is a set of inequations of the form
<ul>
<li>
 <span class="bracket"><span class="id">X</span>(<span class="id">s</span>) &gt;= <span class="id">transf</span> <span class="id">n</span> <span class="id">X</span>(<span class="id">n</span>)</span>
  if program point <span class="bracket"><span class="id">s</span></span> is a successor of program point <span class="bracket"><span class="id">n</span></span>
</li>
<li>
 <span class="bracket"><span class="id">X</span>(<span class="id">n</span>) &gt;= <span class="id">a</span></span>
  if <span class="bracket"><span class="id">n</span></span> is an entry point and <span class="bracket"><span class="id">a</span></span> its minimal approximation.
</li>
</ul>
The unknowns are the <span class="bracket"><span class="id">X</span>(<span class="id">n</span>)</span>, indexed by program points (e.g. nodes in the
CFG graph of a RTL function).  They range over a given ordered set that
represents static approximations of the program state at each point.
The <span class="bracket"><span class="id">transf</span></span> function is the abstract transfer function: it computes an
approximation <span class="bracket"><span class="id">transf</span> <span class="id">n</span> <span class="id">X</span>(<span class="id">n</span>)</span> of the program state after executing instruction
at point <span class="bracket"><span class="id">n</span></span>, as a function of the approximation <span class="bracket"><span class="id">X</span>(<span class="id">n</span>)</span> of the program state
before executing that instruction.
Symmetrically, a backward dataflow problem is a set of inequations of the form
<ul>
<li>
 <span class="bracket"><span class="id">X</span>(<span class="id">n</span>) &gt;= <span class="id">transf</span> <span class="id">s</span> <span class="id">X</span>(<span class="id">s</span>)</span>
  if program point <span class="bracket"><span class="id">s</span></span> is a successor of program point <span class="bracket"><span class="id">n</span></span>
</li>
<li>
 <span class="bracket"><span class="id">X</span>(<span class="id">n</span>) &gt;= <span class="id">a</span></span>
  if <span class="bracket"><span class="id">n</span></span> is an entry point and <span class="bracket"><span class="id">a</span></span> its minimal approximation.
</li>
</ul>
The only difference with a forward dataflow problem is that the transfer
function <span class="bracket"><span class="id">transf</span></span> now computes the approximation before a program point <span class="bracket"><span class="id">s</span></span>
from the approximation <span class="bracket"><span class="id">X</span>(<span class="id">s</span>)</span> after point <span class="bracket"><span class="id">s</span></span>.
This file defines three solvers for dataflow problems.  The first two
solve (optimally) forward and backward problems using Kildall's worklist
algorithm.  They assume that the unknowns range over a semi-lattice, that is,
an ordered type equipped with a least upper bound operation.
The last solver corresponds to propagation over extended basic blocks:
it returns approximate solutions of forward problems where the unknowns
range over any ordered type having a greatest element <span class="bracket"><span class="id">top</span></span>.  It simply
sets <span class="bracket"><span class="id">X</span>(<span class="id">n</span>) = <span class="id">top</span></span> for all merge points <span class="bracket"><span class="id">n</span></span>, that is, program points having
several predecessors.  This solver is useful when least upper bounds of
approximations do not exist or are too expensive to compute. </div>
<br/>
<h1> Solving forward dataflow problems using Kildall's algorithm </h1>
<br/>
<div class="doc">A forward dataflow solver has the following generic interface.
  Unknowns range over the type <span class="bracket"><span class="id">L.t</span></span>, which is equipped with
  semi-lattice operations (see file <span class="bracket"><span class="id">Lattice</span></span>).  </div>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="DATAFLOW_SOLVER">DATAFLOW_SOLVER</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">Declare</span> <span class="kwd">Module</span> <span class="id"><a name="DATAFLOW_SOLVER.L">L</a></span>: <span class="id"><a href="compcert.lib.Lattice.html#SEMILATTICE">SEMILATTICE</a></span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">fixpoint</span> <span class="id">successors</span> <span class="id">transf</span> <span class="id">ep</span> <span class="id">ev</span></span> is the solver.
    It returns either an error or a mapping from program points to
    values of type <span class="bracket"><span class="id">L.t</span></span> representing the solution.  <span class="bracket"><span class="id">successors</span></span>
    is a finite map returning the list of successors of the given program
    point. <span class="bracket"><span class="id">transf</span></span> is the transfer function, <span class="bracket"><span class="id">ep</span></span> the entry point,
    and <span class="bracket"><span class="id">ev</span></span> the minimal abstract value for <span class="bracket"><span class="id">ep</span></span>. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="DATAFLOW_SOLVER.fixpoint">fixpoint</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) (<span class="id">successors</span>: <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">transf</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.t">L.t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.t">L.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ep</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">ev</span>: <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.t">L.t</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.t">PMap.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.t">L.t</a></span>).<br/>
<br/>
<div class="doc">The <span class="bracket"><span class="id">fixpoint_solution</span></span> theorem shows that the returned solution,
    if any, satisfies the dataflow inequations. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="DATAFLOW_SOLVER.fixpoint_solution">fixpoint_solution</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">successors</span> <span class="id">transf</span> <span class="id">ep</span> <span class="id">ev</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.eq">L.eq</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.bot">L.bot</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.bot">L.bot</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<br/>
<div class="doc">The <span class="bracket"><span class="id">fixpoint_entry</span></span> theorem shows that the returned solution,
    if any, satisfies the additional constraint over the entry point. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="DATAFLOW_SOLVER.fixpoint_entry">fixpoint_entry</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">successors</span> <span class="id">transf</span> <span class="id">ep</span> <span class="id">ev</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span>.<br/>
<br/>
<div class="doc">Finally, any property that is preserved by <span class="bracket"><span class="id">L.lub</span></span> and <span class="bracket"><span class="id">transf</span></span>
      and that holds for <span class="bracket"><span class="id">L.bot</span></span> also holds for the results of
      the analysis. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="DATAFLOW_SOLVER.fixpoint_invariant">fixpoint_invariant</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">successors</span> <span class="id">transf</span> <span class="id">ep</span> <span class="id">ev</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span>: <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.t">L.t</a></span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.bot">L.bot</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#y">y</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.lub">L.lub</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> <span class="id"><a href="compcert.backend.Kildall.html#y">y</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">instr</span> <span class="id">x</span>, <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span> <span class="id">pc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER">DATAFLOW_SOLVER</a></span>.<br/>
<br/>
<div class="doc">Kildall's algorithm manipulates worklists, which are sets of CFG nodes
  equipped with a ``pick next node to examine'' operation.
  The algorithm converges faster if the nodes are chosen in an order
  consistent with a reverse postorder traversal of the CFG.
  For now, we parameterize the dataflow solver over a module
  that implements sets of CFG nodes. </div>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="NODE_SET">NODE_SET</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="NODE_SET.t">t</a></span>: <span class="kwd">Type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="NODE_SET.empty">empty</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="NODE_SET.add">add</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.t">t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="NODE_SET.pick">pick</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.t">t</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.t">t</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="NODE_SET.all_nodes">all_nodes</a></span>: <span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>}, <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.t">t</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="NODE_SET.In">In</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.t">t</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="NODE_SET.empty_spec">empty_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, ~<span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.empty">empty</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="NODE_SET.add_spec">add_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">n</span>' <span class="id">s</span>, <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.In">In</a></span> <span class="id">n</span>' (<span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.add">add</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>) &lt;-&gt; <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id">n</span>' \/ <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.In">In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="NODE_SET.pick_none">pick_none</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.pick">pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; ~<span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="NODE_SET.pick_some">pick_some</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">n</span> <span class="id">s</span>', <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.pick">pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>, <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.In">In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> &lt;-&gt; <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id">n</span>' \/ <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.In">In</a></span> <span class="id">n</span>' <span class="id">s</span>'.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="NODE_SET.all_nodes_spec">all_nodes_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">n</span> <span class="id">instr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#NODE_SET.all_nodes">all_nodes</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET">NODE_SET</a></span>.<br/>
<br/>
<div class="doc">Reachability in a control-flow graph. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="REACHABLE">REACHABLE</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) (<span class="id">successors</span>: <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="reachable">reachable</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="reachable_refl">reachable_refl</a></span>: <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="reachable_left">reachable_left</a></span>: <span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">n3</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#REACHABLE.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n1">n1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n2">n2</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#REACHABLE.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span>) -&gt; <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n2">n2</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n3">n3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n1">n1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n3">n3</a></span>.<br/>
<br/>
<span class="kwd">Scheme</span> <span class="id"><a name="reachable_ind">reachable_ind</a></span> := <span class="kwd">Induction</span> <span class="kwd">for</span> <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="kwd">Sort</span> <span class="kwd">Prop</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reachable_trans">reachable_trans</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span>, <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n1">n1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n2">n2</a></span> -&gt; <span class="kwd">forall</span> <span class="id">n3</span>, <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n2">n2</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n3">n3</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n1">n1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n3">n3</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2849')">Proof.</div>
<div class="proofscript" id="proof2849">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reachable_right">reachable_right</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">n3</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n1">n1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n2">n2</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#REACHABLE.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n2">n2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n3">n3</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#REACHABLE.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n1">n1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n3">n3</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2850')">Proof.</div>
<div class="proofscript" id="proof2850">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#reachable_trans">reachable_trans</a></span> <span class="kwd">with</span> <span class="id">n2</span>; <span class="tactic">auto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#REACHABLE">REACHABLE</a></span>.<br/>
<br/>
<div class="doc">We now define a generic solver for forward dataflow inequations
  that works over any semi-lattice structure. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Dataflow_Solver">Dataflow_Solver</a></span> (<span class="id">LAT</span>: <span class="id"><a href="compcert.lib.Lattice.html#SEMILATTICE">SEMILATTICE</a></span>) (<span class="id">NS</span>: <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET">NODE_SET</a></span>) &lt;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#DATAFLOW_SOLVER">DATAFLOW_SOLVER</a></span> <span class="kwd">with</span> <span class="kwd">Module</span> <span class="id">L</span> := <span class="id"><a href="compcert.backend.Kildall.html#LAT">LAT</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Dataflow_Solver.L">L</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#LAT">LAT</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Dataflow_Solver.Kildall">Kildall</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span>: <span class="kwd">Type</span>}.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Dataflow_Solver.Kildall.code">code</a></span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.A">A</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Dataflow_Solver.Kildall.successors">successors</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Dataflow_Solver.Kildall.transf">transf</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>.<br/>
<br/>
<div class="doc">The state of the iteration has three components:
<ul>
<li>
 <span class="bracket"><span class="id">aval</span></span>: A mapping from program points to values of type <span class="bracket"><span class="id">L.t</span></span> representing
  the candidate solution found so far.
</li>
<li>
 <span class="bracket"><span class="id">worklist</span></span>: A worklist of program points that remain to be considered.
</li>
<li>
 <span class="bracket"><span class="id">visited</span></span>: A set of program points that were visited already
  (i.e. put on the worklist at some point in the past).
</li>
</ul>
Only the first two components are computationally relevant.  The third
is a ghost variable used only for stating and proving invariants.
For this reason, <span class="bracket"><span class="id">visited</span></span> is defined at sort <span class="bracket"><span class="kwd">Prop</span></span> so that it is
erased during program extraction.
</div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="Dataflow_Solver.state">state</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="Dataflow_Solver.mkstate">mkstate</a></span> { <span class="id"><a name="Dataflow_Solver.aval">aval</a></span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>; <span class="id"><a name="Dataflow_Solver.worklist">worklist</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#NS.t">NS.t</a></span>; <span class="id"><a name="Dataflow_Solver.visited">visited</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="kwd">Prop</span> }.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.abstr_value">abstr_value</a></span> (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">s</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span>) : <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.bot">L.bot</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Kildall's algorithm, in pseudo-code, is as follows:
<pre>
    while worklist is not empty, do
        extract a node n from worklist
        compute out = transf n aval[n]
        for each successor s of n:
            compute in = lub aval[s] out
            if in &lt;&gt; aval[s]:
                aval[s] := in
                worklist := worklist union {s}
                visited := visited union {s}
            end if
        end for
    end while
    return aval</pre>
</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">propagate_succ</span></span> corresponds, in the pseudocode,
  to the body of the <span class="bracket"><span class="kwd">for</span></span> loop iterating over all successors. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.propagate_succ">propagate_succ</a></span> (<span class="id">s</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span>) (<span class="id">out</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.lib.Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#out">out</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">worklist</span> := <span class="id"><a href="compcert.backend.Kildall.html#NS.add">NS.add</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">visited</span> := <span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> \/ <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span> |}<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">oldl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">newl</span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.lub">L.lub</a></span> <span class="id">oldl</span> <span class="id"><a href="compcert.backend.Kildall.html#out">out</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.beq">L.beq</a></span> <span class="id">oldl</span> <span class="id"><a href="compcert.backend.Kildall.html#newl">newl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> {| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.lib.Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#newl">newl</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">worklist</span> := <span class="id"><a href="compcert.backend.Kildall.html#NS.add">NS.add</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">visited</span> := <span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> \/ <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span> |}<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">propagate_succ_list</span></span> corresponds, in the pseudocode,
  to the <span class="bracket"><span class="kwd">for</span></span> loop iterating over all successors. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Dataflow_Solver.propagate_succ_list">propagate_succ_list</a></span> (<span class="id">s</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span>) (<span class="id">out</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>) (<span class="id">succs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="kwd">struct</span> <span class="id">succs</span>} : <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#succs">succs</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span><br/>
&nbsp;&nbsp;| <span class="id">n</span> :: <span class="id">rem</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#propagate_succ_list">propagate_succ_list</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ">propagate_succ</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#out">out</a></span> <span class="id">n</span>) <span class="id"><a href="compcert.backend.Kildall.html#out">out</a></span> <span class="id">rem</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">step</span></span> corresponds to the body of the outer <span class="bracket"><span class="id">while</span></span> loop in the
  pseudocode. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.step">step</a></span> (<span class="id">s</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span>) : <span class="id"><a href="compcert.lib.Maps.html#PMap.t">PMap.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span> + <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">_</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.bot">L.bot</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">n</span>, <span class="id">rem</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id">n</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">_</span> {| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>); <span class="id">worklist</span> := <span class="id">rem</span>; <span class="id">visited</span> := <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">instr</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">_</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list">propagate_succ_list</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>); <span class="id">worklist</span> := <span class="id">rem</span>; <span class="id">visited</span> := <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id">n</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id">n</span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id">instr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The whole fixpoint computation is the iteration of <span class="bracket"><span class="id">step</span></span> from
  an initial state. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.fixpoint_from">fixpoint_from</a></span> (<span class="id">start</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.t">PMap.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Iteration.html#PrimIter.iterate">PrimIter.iterate</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span> <span class="id"><a href="compcert.backend.Kildall.html#start">start</a></span>.<br/>
<br/>
<div class="doc">There are several ways to build the initial state.  For forward
  dataflow analyses, the initial worklist is the function entry point,
  and the initial mapping sets the function entry point to the given
  abstract value, and leaves unset all other program points, which
  corresponds to <span class="bracket"><span class="id">L.bot</span></span> initial abstract values. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.start_state">start_state</a></span> (<span class="id">enode</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">eval</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>) :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.lib.Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enode">enode</a></span> <span class="id"><a href="compcert.backend.Kildall.html#eval">eval</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PTree.empty">PTree.empty</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">worklist</span> := <span class="id"><a href="compcert.backend.Kildall.html#NS.add">NS.add</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enode">enode</a></span> <span class="id"><a href="compcert.backend.Kildall.html#NS.empty">NS.empty</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">visited</span> := <span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#enode">enode</a></span> |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.fixpoint">fixpoint</a></span> (<span class="id">enode</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">eval</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from">fixpoint_from</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state">start_state</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enode">enode</a></span> <span class="id"><a href="compcert.backend.Kildall.html#eval">eval</a></span>).<br/>
<br/>
<div class="doc">For backward analyses (viewed as forward analyses on the reversed CFG),
  the following two variants are more useful.  Both start with an
  empty initial mapping, where all program points start at <span class="bracket"><span class="id">L.bot</span></span>.
  The first initializes the worklist with a given set of entry points
  in the reversed CFG.  (See the backward dataflow solver below for
  how this list is computed.)  The second start state construction
  initializes the worklist with all program points of the given CFG. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.start_state_nodeset">start_state_nodeset</a></span> (<span class="id">enodes</span>: <span class="id"><a href="compcert.backend.Kildall.html#NS.t">NS.t</a></span>) :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.lib.Maps.html#PTree.empty">PTree.empty</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">worklist</span> := <span class="id"><a href="compcert.backend.Kildall.html#enodes">enodes</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">visited</span> := <span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enodes">enodes</a></span> |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.fixpoint_nodeset">fixpoint_nodeset</a></span> (<span class="id">enodes</span>: <span class="id"><a href="compcert.backend.Kildall.html#NS.t">NS.t</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from">fixpoint_from</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_nodeset">start_state_nodeset</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enodes">enodes</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.start_state_allnodes">start_state_allnodes</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.lib.Maps.html#PTree.empty">PTree.empty</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">worklist</span> := <span class="id"><a href="compcert.backend.Kildall.html#NS.all_nodes">NS.all_nodes</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">visited</span> := <span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id">exists</span> <span class="id">instr</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Dataflow_Solver.fixpoint_allnodes">fixpoint_allnodes</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from">fixpoint_from</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_allnodes">start_state_allnodes</a></span>.<br/>
<br/>
<h2> Characterization of the propagation functions </h2>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Dataflow_Solver.optge">optge</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Dataflow_Solver.optge_some">optge_some</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">l</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> <span class="id">l</span>' -&gt; <span class="id"><a href="compcert.backend.Kildall.html#optge">optge</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a name="Dataflow_Solver.optge_none">optge_none</a></span>: <span class="kwd">forall</span> <span class="id">ol</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol">ol</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Dataflow_Solver.optge_refl">optge_refl</a></span>: <span class="kwd">forall</span> <span class="id">ol</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol">ol</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol">ol</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2851')">Proof.</div>
<div class="proofscript" id="proof2851">
 <span class="tactic">destruct</span> <span class="id">ol</span>; <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_refl">L.ge_refl</a></span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.eq_refl">L.eq_refl</a></span>. Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Dataflow_Solver.optge_trans">optge_trans</a></span>: <span class="kwd">forall</span> <span class="id">ol1</span> <span class="id">ol2</span> <span class="id">ol3</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol1">ol1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol2">ol2</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol2">ol2</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol3">ol3</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol1">ol1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ol3">ol3</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2852')">Proof.</div>
<div class="proofscript" id="proof2852">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_trans">L.ge_trans</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Dataflow_Solver.optge_abstr_value">optge_abstr_value</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">n</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge">L.ge</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>) (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2853')">Proof.</div>
<div class="proofscript" id="proof2853">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_bot">L.ge_bot</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.propagate_succ_charact">propagate_succ_charact</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">out</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st</span>' := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ">propagate_succ</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> <span class="id"><a href="compcert.backend.Kildall.html#out">out</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#out">out</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> &lt;&gt; <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) \/ <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>))<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) -&gt; <span class="id">n</span>' = <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> \/ <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>))<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>' -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>')<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>' -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) \/ <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>')<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">n</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">n</span>' &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2854')">Proof.</div>
<div class="proofscript" id="proof2854">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ">propagate_succ</a></span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">st</span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">n</span> <span class="kwd">as</span> [<span class="id">v</span>|] <span class="id">eqn</span>:<span class="id">E</span>;<br/>
&nbsp;&nbsp;[<span class="id">predSpec</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.beq">L.beq</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.beq_correct">L.beq_correct</a></span> <span class="id">v</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.lub">L.lub</a></span> <span class="id">v</span> <span class="id">out</span>) | <span class="id">idtac</span>].<br/>
- <span class="comment">(*&nbsp;already&nbsp;there,&nbsp;unchanged&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_trans">L.ge_trans</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_refl">L.ge_refl</a></span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_lub_right">L.ge_lub_right</a></span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_refl">optge_refl</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">congruence</span>.<br/>
- <span class="comment">(*&nbsp;already&nbsp;there,&nbsp;updated&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gss">PTree.gss</a></span>. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_lub_right">L.ge_lub_right</a></span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">s</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">s</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_lub_left">L.ge_lub_left</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_refl">optge_refl</a></span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">n</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span>' <span class="id">n</span>). <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
- <span class="comment">(*&nbsp;not&nbsp;previously&nbsp;there,&nbsp;updated&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gss">PTree.gss</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_refl">optge_refl</a></span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">s</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">s</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_refl">optge_refl</a></span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">n</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span>' <span class="id">n</span>). <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.propagate_succ_list_charact">propagate_succ_list_charact</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">out</span> <span class="id">l</span> <span class="id">st</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st</span>' := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list">propagate_succ_list</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> <span class="id"><a href="compcert.backend.Kildall.html#out">out</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#out">out</a></span>))<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>, ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) \/ <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>))<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> \/ <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>))<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>' -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>')<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>' -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id">n</span>' <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) \/ <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>')<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">n</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">n</span>' &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2855')">Proof.</div>
<div class="proofscript" id="proof2855">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_refl">optge_refl</a></span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">congruence</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_charact">propagate_succ_charact</a></span> <span class="id">st</span> <span class="id">out</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">st1</span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ">propagate_succ</a></span> <span class="id">st</span> <span class="id">out</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">A1</span> &amp; <span class="id">A2</span> &amp; <span class="id">A3</span> &amp; <span class="id">A4</span> &amp; <span class="id">A5</span> &amp; <span class="id">A6</span> &amp; <span class="id">A7</span> &amp; <span class="id">A8</span> &amp; <span class="id">A9</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">IHl</span> <span class="id">st1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">st2</span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list">propagate_succ_list</a></span> <span class="id">st1</span> <span class="id">out</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">B1</span> &amp; <span class="id">B2</span> &amp; <span class="id">B3</span> &amp; <span class="id">B4</span> &amp; <span class="id">B5</span> &amp; <span class="id">B6</span> &amp; <span class="id">B7</span> &amp; <span class="id">B8</span> &amp; <span class="id">B9</span>). <span class="tactic">clear</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span> <span class="id">n</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_trans">optge_trans</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">B2</span> <span class="tactic">by</span> <span class="tactic">tauto</span>. <span class="tactic">apply</span> <span class="id">A2</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_trans">optge_trans</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">B4</span> <span class="id">n</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span> <span class="id">n</span>. <span class="tactic">destruct</span> <span class="id">A4</span>. <span class="id">left</span>; <span class="tactic">auto</span>. <span class="id">right</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">B6</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span>|<span class="id">P</span>]. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">A6</span>; <span class="tactic">eauto</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">B8</span> <span class="id">n</span>'); <span class="id">specialize</span> (<span class="id">A8</span> <span class="id">n</span>'). <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">st1</span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">n</span>' <span class="id">eqn</span>:<span class="id">ST1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">B7</span>. <span class="tactic">apply</span> <span class="id">A9</span>; <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">B9</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Characterization of <span class="bracket"><span class="id">fixpoint_from</span></span>. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Dataflow_Solver.steps">steps</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Dataflow_Solver.steps_base">steps_base</a></span>: <span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="compcert.backend.Kildall.html#steps">steps</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Dataflow_Solver.steps_right">steps_right</a></span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span>, <span class="id"><a href="compcert.backend.Kildall.html#steps">steps</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s1">s1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s2">s2</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s2">s2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s3">s3</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#steps">steps</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s1">s1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s3">s3</a></span>.<br/>
<br/>
<span class="kwd">Scheme</span> <span class="id"><a name="Dataflow_Solver.steps_ind">steps_ind</a></span> := <span class="kwd">Induction</span> <span class="kwd">for</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps">steps</a></span> <span class="kwd">Sort</span> <span class="kwd">Prop</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.fixpoint_from_charact">fixpoint_from_charact</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">start</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from">fixpoint_from</a></span> <span class="id"><a href="compcert.backend.Kildall.html#start">start</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps">steps</a></span> <span class="id"><a href="compcert.backend.Kildall.html#start">start</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> /\ <span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> /\ <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> = (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.bot">L.bot</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2856')">Proof.</div>
<div class="proofscript" id="proof2856">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint">fixpoint</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="compcert.lib.Iteration.html#PrimIter.iterate_prop">PrimIter.iterate_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">st</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps">steps</a></span> <span class="id">start</span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">res</span> =&gt; <span class="id">exists</span> <span class="id">st</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps">steps</a></span> <span class="id">start</span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> /\ <span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> /\ <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> = (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.bot">L.bot</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>))); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">E</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span> <span class="kwd">in</span> <span class="id">E</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span> <span class="id">a</span>)) <span class="kwd">as</span> [[<span class="id">n</span> <span class="id">rem</span>]|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id">n</span>); <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">E</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps_right">steps_right</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<h2> Monotonicity properties </h2>
<br/>
<div class="doc">We first show that the <span class="bracket"><span class="id">aval</span></span> and <span class="bracket"><span class="id">visited</span></span> parts of the state
evolve monotonically:
<ul>
<li>
 at each step, the values of the <span class="bracket"><span class="id">aval</span>[<span class="id">n</span>]</span> either remain the same or
  increase with respect to the <span class="bracket"><span class="id">optge</span></span> ordering;
</li>
<li>
 every node visited in the past remains visited in the future.
</li>
</ul>
</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.step_incr">step_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s1">s1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s2">s2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s2">s2</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s1">s1</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> /\ (<span class="id"><a href="compcert.backend.Kildall.html#s1">s1</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#s2">s2</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2857')">Proof.</div>
<div class="proofscript" id="proof2857">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span> <span class="id">s1</span>)) <span class="kwd">as</span> [[<span class="id">p</span> <span class="id">rem</span>] | ]; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id">p</span>) <span class="kwd">as</span> [<span class="id">instr</span>|]; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list_charact">propagate_succ_list_charact</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id">p</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id">p</span> <span class="id">s1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id">instr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span> <span class="id">s1</span>; <span class="id">worklist</span> := <span class="id">rem</span>; <span class="id">visited</span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span> <span class="id">s1</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">s</span>' := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list">propagate_succ_list</a></span> {| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span> <span class="id">s1</span>; <span class="id">worklist</span> := <span class="id">rem</span>; <span class="id">visited</span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span> <span class="id">s1</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id">p</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id">p</span> <span class="id">s1</span>)) (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id">instr</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">A1</span> &amp; <span class="id">A2</span> &amp; <span class="id">A3</span> &amp; <span class="id">A4</span> &amp; <span class="id">A5</span> &amp; <span class="id">A6</span> &amp; <span class="id">A7</span> &amp; <span class="id">A8</span> &amp; <span class="id">A9</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_refl">optge_refl</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.steps_incr">steps_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps">steps</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s1">s1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s2">s2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s2">s2</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s1">s1</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> /\ (<span class="id"><a href="compcert.backend.Kildall.html#s1">s1</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#s2">s2</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2858')">Proof.</div>
<div class="proofscript" id="proof2858">
&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
- <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_refl">optge_refl</a></span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">IHsteps</span>. <span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step_incr">step_incr</a></span> <span class="id">n</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_trans">optge_trans</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h2> Correctness invariant </h2>
<br/>
<div class="doc">The following invariant is preserved at each iteration of Kildall's
  algorithm: for all visited program point <span class="bracket"><span class="id">n</span></span>, either
  <span class="bracket"><span class="id">n</span></span> is in the worklist, or the inequations associated with <span class="bracket"><span class="id">n</span></span>
  (<span class="bracket"><span class="id">aval</span>[<span class="id">s</span>] &gt;= <span class="id">transf</span> <span class="id">n</span> <span class="id">aval</span>[<span class="id">n</span>]</span> for all successors <span class="bracket"><span class="id">s</span></span> of <span class="bracket"><span class="id">n</span></span>)
  hold.  In other terms, the worklist contains all nodes that were
  visited but do not yet satisfy their inequations.
  The second part of the invariant shows that nodes that already have
  an abstract value associated with them have been visited. </div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="Dataflow_Solver.good_state">good_state</a></span> (<span class="id">st</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.state">state</a></span>) : <span class="kwd">Prop</span> := {<br/>
&nbsp;&nbsp;<span class="id"><a name="Dataflow_Solver.gs_stable">gs_stable</a></span>: <span class="kwd">forall</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge">optge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>))));<br/>
&nbsp;&nbsp;<span class="id"><a name="Dataflow_Solver.gs_defined">gs_defined</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#v">v</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span><br/>
}.<br/>
<br/>
<div class="doc">We show that the <span class="bracket"><span class="id">step</span></span> function preserves this invariant. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.step_state_good">step_state_good</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">pc</span> <span class="id">rem</span> <span class="id">instr</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#rem">rem</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list">propagate_succ_list</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#rem">rem</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2859')">Proof.</div>
<div class="proofscript" id="proof2859">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">instr</span>; <span class="tactic">intros</span> <span class="id">PICK</span> <span class="id">CODEAT</span> [<span class="id">GOOD1</span> <span class="id">GOOD2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Kildall.html#NS.pick_some">NS.pick_some</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">PICK</span>); <span class="tactic">intro</span> <span class="id">PICK2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">out</span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id">pc</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id">pc</span> <span class="id">st</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list_charact">propagate_succ_list_charact</a></span> <span class="id">out</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id">instr</span>) {| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span> <span class="id">st</span>; <span class="id">worklist</span> := <span class="id">rem</span>; <span class="id">visited</span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span> <span class="id">st</span> |}).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">st</span>' := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list">propagate_succ_list</a></span> {| <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">aval</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span> <span class="id">st</span>; <span class="id">worklist</span> := <span class="id">rem</span>; <span class="id">visited</span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span> <span class="id">st</span> |} <span class="id">out</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id">instr</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">intros</span> (<span class="id">A1</span> &amp; <span class="id">A2</span> &amp; <span class="id">A3</span> &amp; <span class="id">A4</span> &amp; <span class="id">A5</span> &amp; <span class="id">A6</span> &amp; <span class="id">A7</span> &amp; <span class="id">A8</span> &amp; <span class="id">A9</span>).<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
- <span class="comment">(*&nbsp;stable&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">A8</span> <span class="id">n</span> <span class="id">H</span>); <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id">A4</span> <span class="id">n</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id">n</span> <span class="id">st</span>') <span class="kwd">with</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id">n</span> <span class="id">st</span>)<br/>
&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span>; <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">GOOD1</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span>|<span class="id">P</span>].<br/>
+ <span class="comment">(*&nbsp;n&nbsp;was&nbsp;on&nbsp;the&nbsp;worklist&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PICK2</span> <span class="kwd">in</span> <span class="id">P</span>; <span class="tactic">destruct</span> <span class="id">P</span>.<br/>
&nbsp;&nbsp;* <span class="comment">(*&nbsp;node&nbsp;n&nbsp;is&nbsp;our&nbsp;node&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">n</span>. <span class="id">fold</span> <span class="id">out</span>. <span class="id">right</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">i</span> = <span class="id">instr</span>) <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">subst</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">A1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;* <span class="comment">(*&nbsp;n&nbsp;was&nbsp;already&nbsp;on&nbsp;the&nbsp;worklist&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">apply</span> <span class="id">A5</span>; <span class="tactic">auto</span>.<br/>
+ <span class="comment">(*&nbsp;n&nbsp;was&nbsp;stable&nbsp;before,&nbsp;still&nbsp;is&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.optge_trans">optge_trans</a></span> <span class="kwd">with</span> <span class="id">st</span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">s</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;defined&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">st</span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">n</span> <span class="kwd">as</span> [<span class="id">v</span>'|] <span class="id">eqn</span>:<span class="id">ST</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">A7</span>. <span class="tactic">eapply</span> <span class="id">GOOD2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">A9</span>; <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.step_state_good_2">step_state_good_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">pc</span> <span class="id">rem</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#rem">rem</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#rem">rem</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2860')">Proof.</div>
<div class="proofscript" id="proof2860">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">rem</span>; <span class="tactic">intros</span> [<span class="id">GOOD1</span> <span class="id">GOOD2</span>] <span class="id">PICK</span> <span class="id">CODE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Kildall.html#NS.pick_some">NS.pick_some</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">PICK</span>); <span class="tactic">intro</span> <span class="id">PICK2</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="comment">(*&nbsp;stable&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">GOOD1</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span> | <span class="id">P</span>].<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PICK2</span> <span class="kwd">in</span> <span class="id">P</span>. <span class="tactic">destruct</span> <span class="id">P</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">n</span>. <span class="id">right</span>; <span class="tactic">intros</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">exact</span> <span class="id">P</span>.<br/>
- <span class="comment">(*&nbsp;defined&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">GOOD2</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.steps_state_good">steps_state_good</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps">steps</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st1">st1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st2">st2</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st1">st1</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st2">st2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2861')">Proof.</div>
<div class="proofscript" id="proof2861">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span> <span class="kwd">in</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span> <span class="id">s2</span>)) <span class="kwd">as</span> [[<span class="id">n</span> <span class="id">rem</span>] | ] <span class="id">eqn</span>:<span class="id">PICK</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id">n</span>) <span class="kwd">as</span> [<span class="id">instr</span>|] <span class="id">eqn</span>:<span class="id">CODE</span>; <span class="id">inv</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step_state_good">step_state_good</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step_state_good_2">step_state_good_2</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">We show that initial states satisfy the invariant. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.start_state_good">start_state_good</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">enode</span> <span class="id">eval</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state">start_state</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enode">enode</a></span> <span class="id"><a href="compcert.backend.Kildall.html#eval">eval</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2862')">Proof.</div>
<div class="proofscript" id="proof2862">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state">start_state</a></span>; <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">subst</span> <span class="id">n</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span> <span class="id">enode</span>). <span class="tactic">auto</span>. <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.start_state_nodeset_good">start_state_nodeset_good</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">enodes</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_nodeset">start_state_nodeset</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enodes">enodes</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2863')">Proof.</div>
<div class="proofscript" id="proof2863">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_nodeset">start_state_nodeset</a></span>; <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">left</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.start_state_allnodes_good">start_state_allnodes_good</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_allnodes">start_state_allnodes</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2864')">Proof.</div>
<div class="proofscript" id="proof2864">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_allnodes">start_state_allnodes</a></span>; <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">instr</span> <span class="id">CODE</span>]. <span class="id">left</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.all_nodes_spec">NS.all_nodes_spec</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Reachability in final states. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Dataflow_Solver.reachable_visited">reachable_visited</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.good_state">good_state</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span> <span class="id"><a href="compcert.backend.Kildall.html#q">q</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#q">q</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2865')">Proof.</div>
<div class="proofscript" id="proof2865">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">st</span> [<span class="id">GOOD1</span> <span class="id">GOOD2</span>] <span class="id">PICK</span>. <span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">IHreachable</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">GOOD1</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span> | <span class="id">P</span>].<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.pick_none">NS.pick_none</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">P</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">OGE</span>; <span class="id">inv</span> <span class="id">OGE</span>. <span class="tactic">eapply</span> <span class="id">GOOD2</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h2> Correctness of the solution returned by <span class="bracket"><span class="id">fixpoint</span></span>. </h2>
<br/>
<div class="doc">As a consequence of the <span class="bracket"><span class="id">good_state</span></span> invariant, the result of
  <span class="bracket"><span class="id">fixpoint</span></span>, if defined, is a solution of the dataflow inequations.
  This assumes that the transfer function maps <span class="bracket"><span class="id">L.bot</span></span> to <span class="bracket"><span class="id">L.bot</span></span>. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Dataflow_Solver.fixpoint_solution">fixpoint_solution</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ep</span> <span class="id">ev</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.eq">L.eq</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.bot">L.bot</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.bot">L.bot</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2866')">Proof.</div>
<div class="proofscript" id="proof2866">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint">fixpoint</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from_charact">fixpoint_from_charact</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">st</span> &amp; <span class="id">STEPS</span> &amp; <span class="id">PICK</span> &amp; <span class="id">RES</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps_state_good">steps_state_good</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_good">start_state_good</a></span>. <span class="tactic">intros</span> [<span class="id">GOOD1</span> <span class="id">GOOD2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">RES</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.get">PMap.get</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">st</span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span>)!<span class="id">n</span> <span class="kwd">as</span> [<span class="id">v</span>|] <span class="id">eqn</span>:<span class="id">STN</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">GOOD1</span> <span class="id">n</span>) <span class="kwd">as</span> [<span class="id">P</span>|<span class="id">P</span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.pick_none">NS.pick_none</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">P</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span>; <span class="tactic">rewrite</span> <span class="id">STN</span>. <span class="tactic">intros</span> <span class="id">OGE</span>; <span class="id">inv</span> <span class="id">OGE</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_trans">L.ge_trans</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.bot">L.bot</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_bot">L.ge_bot</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge_refl">L.ge_refl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.eq_sym">L.eq_sym</a></span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Moreover, the result of <span class="bracket"><span class="id">fixpoint</span></span>, if defined, satisfies the additional
  constraint given on the entry point. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Dataflow_Solver.fixpoint_entry">fixpoint_entry</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ep</span> <span class="id">ev</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2867')">Proof.</div>
<div class="proofscript" id="proof2867">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint">fixpoint</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from_charact">fixpoint_from_charact</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">st</span> &amp; <span class="id">STEPS</span> &amp; <span class="id">PICK</span> &amp; <span class="id">RES</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps_incr">steps_incr</a></span> <span class="id">ep</span>); <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gss">PTree.gss</a></span>. <span class="tactic">intros</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">RES</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.get">PMap.get</a></span>; <span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">P</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">For <span class="bracket"><span class="id">fixpoint_allnodes</span></span>, we show that the result is a solution
  without assuming <span class="bracket"><span class="id">transf</span> <span class="id">n</span> <span class="id">L.bot</span> = <span class="id">L.bot</span></span>. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Dataflow_Solver.fixpoint_allnodes_solution">fixpoint_allnodes_solution</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_allnodes">fixpoint_allnodes</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2868')">Proof.</div>
<div class="proofscript" id="proof2868">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_allnodes">fixpoint_allnodes</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from_charact">fixpoint_from_charact</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">st</span> &amp; <span class="id">STEPS</span> &amp; <span class="id">PICK</span> &amp; <span class="id">RES</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps_state_good">steps_state_good</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_allnodes_good">start_state_allnodes_good</a></span>. <span class="tactic">intros</span> [<span class="id">GOOD1</span> <span class="id">GOOD2</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps_incr">steps_incr</a></span> <span class="id">n</span>); <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span> [<span class="id">U</span> <span class="id">V</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">GOOD1</span> <span class="id">n</span>). <span class="tactic">apply</span> <span class="id">V</span>. <span class="id">exists</span> <span class="id">instr</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> [<span class="id">P</span>|<span class="id">P</span>].<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.pick_none">NS.pick_none</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">P</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">OGE</span>. <span class="tactic">rewrite</span> <span class="id">RES</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.get">PMap.get</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">OGE</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<div class="doc">For <span class="bracket"><span class="id">fixpoint_nodeset</span></span>, we show that the result is a solution
  at all program points that are reachable from the given entry points. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Dataflow_Solver.fixpoint_nodeset_solution">fixpoint_nodeset_solution</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">enodes</span> <span class="id">res</span> <span class="id">e</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_nodeset">fixpoint_nodeset</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enodes">enodes</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#e">e</a></span> <span class="id"><a href="compcert.backend.Kildall.html#enodes">enodes</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#e">e</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2869')">Proof.</div>
<div class="proofscript" id="proof2869">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_nodeset">fixpoint_nodeset</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from_charact">fixpoint_from_charact</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">st</span> &amp; <span class="id">STEPS</span> &amp; <span class="id">PICK</span> &amp; <span class="id">RES</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps_state_good">steps_state_good</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state_nodeset_good">start_state_nodeset_good</a></span>. <span class="tactic">intros</span> <span class="id">GOOD</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps_incr">steps_incr</a></span> <span class="id">e</span>); <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span> [<span class="id">U</span> <span class="id">V</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">st</span>.(<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.visited">visited</a></span>) <span class="id">n</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.reachable_visited">reachable_visited</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">GOOD</span> <span class="kwd">as</span> [<span class="id">GOOD1</span> <span class="id">GOOD2</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">GOOD1</span> <span class="id">n</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span>|<span class="id">P</span>].<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.pick_none">NS.pick_none</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">P</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">OGE</span>. <span class="tactic">rewrite</span> <span class="id">RES</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.get">PMap.get</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">OGE</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<h2> Preservation of a property over solutions </h2>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Dataflow_Solver.fixpoint_invariant">fixpoint_invariant</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ep</span> <span class="id">ev</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span>: <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.t">L.t</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P_bot</span>: <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.bot">L.bot</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P_lub</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#y">y</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.lub">L.lub</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> <span class="id"><a href="compcert.backend.Kildall.html#y">y</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P_transf</span>: <span class="kwd">forall</span> <span class="id">pc</span> <span class="id">instr</span> <span class="id">x</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P_entrypoint</span>: <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">res</span> <span class="id">pc</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ev">ev</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2870')">Proof.</div>
<div class="proofscript" id="proof2870">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">inv</span> := <span class="kwd">fun</span> <span class="id">st</span> =&gt; <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">inv</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state">start_state</a></span> <span class="id">ep</span> <span class="id">ev</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.start_state">start_state</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">ep</span>). <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">st</span> <span class="id">v</span> <span class="id">n</span>, <span class="id">inv</span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> -&gt; <span class="id">P</span> <span class="id"><a href="compcert.backend.Kildall.html#v">v</a></span> -&gt; <span class="id">inv</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ">propagate_succ</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> <span class="id"><a href="compcert.backend.Kildall.html#v">v</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inv</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ">propagate_succ</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.aval">aval</a></span> <span class="id">st</span>)!<span class="id">n</span> <span class="kwd">as</span> [<span class="id">oldl</span>|] <span class="id">eqn</span>:<span class="id">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.beq">L.beq</a></span> <span class="id">oldl</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.lub">L.lub</a></span> <span class="id">oldl</span> <span class="id">v</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">P_lub</span>; <span class="tactic">auto</span>. <span class="tactic">replace</span> <span class="id">oldl</span> <span class="kwd">with</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id">n</span> <span class="id">st</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span>; <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">l</span> <span class="id">st</span> <span class="id">v</span>, <span class="id">inv</span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> -&gt; <span class="id">P</span> <span class="id"><a href="compcert.backend.Kildall.html#v">v</a></span> -&gt; <span class="id">inv</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.propagate_succ_list">propagate_succ_list</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> <span class="id"><a href="compcert.backend.Kildall.html#v">v</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span>, <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.steps">steps</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st1">st1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st2">st2</a></span> -&gt; <span class="id">inv</span> <span class="id"><a href="compcert.backend.Kildall.html#st1">st1</a></span> -&gt; <span class="id">inv</span> <span class="id"><a href="compcert.backend.Kildall.html#st2">st2</a></span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.step">step</a></span> <span class="kwd">in</span> <span class="id">e</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#NS.pick">NS.pick</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.worklist">worklist</a></span> <span class="id">s2</span>)) <span class="kwd">as</span> [[<span class="id">n</span> <span class="id">rem</span>]|]; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall.code">code</a></span>!<span class="id">n</span>) <span class="kwd">as</span> [<span class="id">instr</span>|] <span class="id">eqn</span>:<span class="id">INSTR</span>; <span class="id">inv</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span>. <span class="tactic">apply</span> <span class="id">IHsteps</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">P_transf</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">IHsteps</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHsteps</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint">fixpoint</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.fixpoint_from_charact">fixpoint_from_charact</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">st</span> &amp; <span class="id">STEPS</span> &amp; <span class="id">PICK</span> &amp; <span class="id">RES</span>).<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">res</span>!!<span class="id">pc</span>) <span class="kwd">with</span> (<span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.abstr_value">abstr_value</a></span> <span class="id">pc</span> <span class="id">st</span>). <span class="tactic">eapply</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">RES</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver.Kildall">Kildall</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver">Dataflow_Solver</a></span>.<br/>
<br/>
<h1> Solving backward dataflow problems using Kildall's algorithm </h1>
<br/>
<div class="doc">A backward dataflow problem on a given flow graph is a forward
  dataflow program on the reversed flow graph, where predecessors replace
  successors.  We exploit this observation to cheaply derive a backward
  solver from the forward solver. </div>
<br/>
<h2> Construction of the reversed flow graph (the predecessor relation) </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="successors_list">successors_list</a></span> (<span class="id">successors</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)) (<span class="id">pc</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt; <span class="id">l</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">a</span> !!! <span class="id">b</span>" := (<span class="id"><a href="compcert.backend.Kildall.html#successors_list">successors_list</a></span> <span class="id">a</span> <span class="id">b</span>) (<span class="tactic">at</span> <span class="id">level</span> 1).<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Predecessor">Predecessor</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span>: <span class="kwd">Type</span>}.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Predecessor.code">code</a></span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Predecessor.A">A</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Predecessor.successors">successors</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#Predecessor.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="add_successors">add_successors</a></span> (<span class="id">pred</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">from</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">tolist</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="kwd">struct</span> <span class="id">tolist</span>} : <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#tolist">tolist</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#pred">pred</a></span><br/>
&nbsp;&nbsp;| <span class="id">to</span> :: <span class="id">rem</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#add_successors">add_successors</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PTree.set">PTree.set</a></span> <span class="id">to</span> (<span class="id"><a href="compcert.backend.Kildall.html#from">from</a></span> :: <span class="id"><a href="compcert.backend.Kildall.html#pred">pred</a></span>!!!<span class="id">to</span>) <span class="id"><a href="compcert.backend.Kildall.html#pred">pred</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#from">from</a></span> <span class="id">rem</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_successors_correct">add_successors_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tolist</span> <span class="id">from</span> <span class="id">pred</span> <span class="id">n</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pred">pred</a></span>!!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> \/ (<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#from">from</a></span> /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#tolist">tolist</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#add_successors">add_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pred">pred</a></span> <span class="id"><a href="compcert.backend.Kildall.html#from">from</a></span> <span class="id"><a href="compcert.backend.Kildall.html#tolist">tolist</a></span>)!!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2871')">Proof.</div>
<div class="proofscript" id="proof2871">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tolist</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHtolist</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#successors_list">successors_list</a></span> <span class="tactic">at</span> 1. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">s</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">a</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">subst</span> <span class="id">n</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="id">fold</span> (<span class="id"><a href="compcert.backend.Kildall.html#successors_list">successors_list</a></span> <span class="id">pred</span> <span class="id">s</span>). <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="make_predecessors">make_predecessors</a></span> : <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Maps.html#PTree.fold">PTree.fold</a></span> (<span class="kwd">fun</span> <span class="id">pred</span> <span class="id">pc</span> <span class="id">instr</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#add_successors">add_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pred">pred</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Predecessor.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Predecessor.code">code</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PTree.empty">PTree.empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="make_predecessors_correct_1">make_predecessors_correct_1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Predecessor.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Predecessor.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span>!!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2872')">Proof.</div>
<div class="proofscript" id="proof2872">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">m</span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#m">m</a></span>!<span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">instr</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">s</span> (<span class="id"><a href="compcert.backend.Kildall.html#Predecessor.successors">successors</a></span> <span class="id">instr</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">n</span> <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span>!!!<span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Maps.html#PTree_Properties.fold_rec">PTree_Properties.fold_rec</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">P</span>); <span class="tactic">unfold</span> <span class="id">P</span>; <span class="tactic">intros</span>.<br/>
<span class="comment">(*&nbsp;extensionality&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
<span class="comment">(*&nbsp;base&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">congruence</span>.<br/>
<span class="comment">(*&nbsp;inductive&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#add_successors_correct">add_successors_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="make_predecessors_correct_2">make_predecessors_correct_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Predecessor.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Predecessor.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l</span>, <span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2873')">Proof.</div>
<div class="proofscript" id="proof2873">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#make_predecessors_correct_1">make_predecessors_correct_1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#successors_list">successors_list</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span>!<span class="id">s</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reachable_predecessors">reachable_predecessors</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Predecessor.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Predecessor.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span> <span class="id"><a href="compcert.backend.Kildall.html#q">q</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#q">q</a></span> <span class="id"><a href="compcert.backend.Kildall.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2874')">Proof.</div>
<div class="proofscript" id="proof2874">
&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
- <span class="id">constructor</span>.<br/>
- <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#make_predecessors_correct_2">make_predecessors_correct_2</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">l</span> [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#reachable_right">reachable_right</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#Predecessor">Predecessor</a></span>.<br/>
<br/>
<h2> Solving backward dataflow problems </h2>
<br/>
<div class="doc">The interface to a backward dataflow solver is as follows. </div>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="BACKWARD_DATAFLOW_SOLVER">BACKWARD_DATAFLOW_SOLVER</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">Declare</span> <span class="kwd">Module</span> <span class="id"><a name="BACKWARD_DATAFLOW_SOLVER.L">L</a></span>: <span class="id"><a href="compcert.lib.Lattice.html#SEMILATTICE">SEMILATTICE</a></span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">fixpoint</span> <span class="id">successors</span> <span class="id">transf</span></span> is the solver.
    It returns either an error or a mapping from program points to
    values of type <span class="bracket"><span class="id">L.t</span></span> representing the solution.  <span class="bracket"><span class="id">successors</span></span>
    is a finite map returning the list of successors of the given program
    point. <span class="bracket"><span class="id">transf</span></span> is the transfer function. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="BACKWARD_DATAFLOW_SOLVER.fixpoint">fixpoint</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) (<span class="id">successors</span>: <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">transf</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.t">L.t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.t">L.t</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.t">PMap.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.t">L.t</a></span>).<br/>
<br/>
<div class="doc">The <span class="bracket"><span class="id">fixpoint_solution</span></span> theorem shows that the returned solution,
    if any, satisfies the backward dataflow inequations. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="BACKWARD_DATAFLOW_SOLVER.fixpoint_solution">fixpoint_solution</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">successors</span> <span class="id">transf</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span> <span class="id">a</span>, <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.eq">L.eq</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#a">a</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.bot">L.bot</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>).<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">fixpoint_allnodes</span></span> is a variant of <span class="bracket"><span class="id">fixpoint</span></span>, less algorithmically
    efficient, but correct without any hypothesis on the transfer function. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="BACKWARD_DATAFLOW_SOLVER.fixpoint_allnodes">fixpoint_allnodes</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) (<span class="id">successors</span>: <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">transf</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.t">L.t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.t">L.t</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.t">PMap.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.t">L.t</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="BACKWARD_DATAFLOW_SOLVER.fixpoint_allnodes_solution">fixpoint_allnodes_solution</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">successors</span> <span class="id">transf</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.fixpoint_allnodes">fixpoint_allnodes</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER">BACKWARD_DATAFLOW_SOLVER</a></span>.<br/>
<br/>
<div class="doc">We construct a generic backward dataflow solver, working over any
  semi-lattice structure, by applying the forward dataflow solver
  with the predecessor relation instead of the successor relation. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Backward_Dataflow_Solver">Backward_Dataflow_Solver</a></span> (<span class="id">LAT</span>: <span class="id"><a href="compcert.lib.Lattice.html#SEMILATTICE">SEMILATTICE</a></span>) (<span class="id">NS</span>: <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET">NODE_SET</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BACKWARD_DATAFLOW_SOLVER">BACKWARD_DATAFLOW_SOLVER</a></span> <span class="kwd">with</span> <span class="kwd">Module</span> <span class="id">L</span> := <span class="id"><a href="compcert.backend.Kildall.html#LAT">LAT</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Backward_Dataflow_Solver.L">L</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#LAT">LAT</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Backward_Dataflow_Solver.DS">DS</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#Dataflow_Solver">Dataflow_Solver</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.L">L</a></span> <span class="id"><a href="compcert.backend.Kildall.html#NS">NS</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Backward_Dataflow_Solver.Kildall">Kildall</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span>: <span class="kwd">Type</span>}.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Backward_Dataflow_Solver.Kildall.code">code</a></span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.A">A</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Backward_Dataflow_Solver.Kildall.successors">successors</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Backward_Dataflow_Solver.Kildall.transf">transf</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.t">L.t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.t">L.t</a></span>.<br/>
<br/>
<div class="doc">Finding entry points for the reverse control-flow graph. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Backward_Dataflow_Solver.Kildall.Exit_points">Exit_points</a></span>.<br/>
<br/>
<div class="doc">Assuming that the nodes of the CFG <span class="bracket"><span class="id">code</span></span> are numbered in reverse
  postorder (cf. pass <span class="bracket"><span class="id">Renumber</span></span>), an edge from <span class="bracket"><span class="id">n</span></span> to <span class="bracket"><span class="id">s</span></span> is a
  normal edge if <span class="bracket"><span class="id">s</span> &lt; <span class="id">n</span></span> and a back-edge otherwise.
  <span class="bracket"><span class="id">sequential_node</span></span> returns <span class="bracket"><span class="id">true</span></span> if the given node has at least one
  normal outgoing edge.  It returns <span class="bracket"><span class="id">false</span></span> if the given node is an exit
  node (no outgoing edges) or the final node of a loop body
  (all outgoing edges are back-edges).  As we prove later, the set
  of all non-sequential node is an appropriate set of entry points
  for exploring the reverse CFG. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Backward_Dataflow_Solver.sequential_node">sequential_node</a></span> (<span class="id">pc</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">instr</span>: <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.A">A</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> (<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="compcert.lib.Coqlib.html#plt">plt</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Backward_Dataflow_Solver.exit_points">exit_points</a></span> : <span class="id"><a href="compcert.backend.Kildall.html#NS.t">NS.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Maps.html#PTree.fold">PTree.fold</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">ep</span> <span class="id">pc</span> <span class="id">instr</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.sequential_node">sequential_node</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add">NS.add</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ep">ep</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#NS.empty">NS.empty</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Backward_Dataflow_Solver.exit_points_charact">exit_points_charact</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.exit_points">exit_points</a></span> &lt;-&gt; <span class="id">exists</span> <span class="id">i</span>, <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span> /\ <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.sequential_node">sequential_node</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2875')">Proof.</div>
<div class="proofscript" id="proof2875">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.exit_points">exit_points</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.lib.Maps.html#PTree_Properties.fold_rec">PTree_Properties.fold_rec</a></span>.<br/>
- <span class="comment">(*&nbsp;extensionality&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;base&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.empty_spec">NS.empty_spec</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">i</span> [<span class="id">P</span> <span class="id">Q</span>]]. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span> <span class="kwd">in</span> <span class="id">P</span>. <span class="tactic">congruence</span>.<br/>
- <span class="comment">(*&nbsp;inductive&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.sequential_node">sequential_node</a></span> <span class="id">k</span> <span class="id">v</span>) <span class="id">eqn</span>:<span class="id">SN</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">split</span>; <span class="tactic">intros</span> [<span class="id">i</span> [<span class="id">P</span> <span class="id">Q</span>]]. <span class="tactic">congruence</span>. <span class="id">inv</span> <span class="id">P</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NS.add_spec">NS.add_spec</a></span>. <span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">split</span>. <span class="tactic">intros</span>. <span class="id">exists</span> <span class="id">v</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intros</span> [<span class="id">P</span> | [<span class="id">i</span> [<span class="id">P</span> <span class="id">Q</span>]]]. <span class="tactic">congruence</span>. <span class="id">exists</span> <span class="id">i</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">i</span> [<span class="id">P</span> <span class="id">Q</span>]]. <span class="id">right</span>; <span class="id">exists</span> <span class="id">i</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Backward_Dataflow_Solver.reachable_exit_points">reachable_exit_points</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span> -&gt; <span class="id">exists</span> <span class="id">x</span>, <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.exit_points">exit_points</a></span> /\ <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2876')">Proof.</div>
<div class="proofscript" id="proof2876">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">pc0</span>. <span class="tactic">pattern</span> <span class="id">pc0</span>. <span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Wf.html#well_founded_ind">well_founded_ind</a></span> <span class="id"><a href="compcert.lib.Coqlib.html#Plt_wf">Plt_wf</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">pc</span> <span class="id">HR</span> <span class="id">i</span> <span class="id">CODE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.sequential_node">sequential_node</a></span> <span class="id">pc</span> <span class="id">i</span>) <span class="id">eqn</span>:<span class="id">SN</span>.<br/>
- <span class="comment">(*&nbsp;at&nbsp;least&nbsp;one&nbsp;successor&nbsp;that&nbsp;decreases&nbsp;the&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.sequential_node">sequential_node</a></span> <span class="kwd">in</span> <span class="id">SN</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span> <span class="kwd">in</span> <span class="id">SN</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SN</span> <span class="kwd">as</span> [<span class="id">s</span> [<span class="id">P</span> <span class="id">Q</span>]]. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id">s</span>) <span class="kwd">as</span> [<span class="id">i</span>'|] <span class="id">eqn</span>:<span class="id">CS</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">InvBooleans</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">HR</span> <span class="id">s</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">x</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#reachable_left">reachable_left</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;otherwise&nbsp;we&nbsp;are&nbsp;an&nbsp;exit&nbsp;point&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">pc</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.exit_points_charact">exit_points_charact</a></span>. <span class="id">exists</span> <span class="id">i</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The crucial property of exit points is that any nonempty node in the
  CFG is reverse-reachable from an exit point. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Backward_Dataflow_Solver.reachable_exit_points_predecessor">reachable_exit_points_predecessor</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>, <span class="id"><a href="compcert.backend.Kildall.html#NS.In">NS.In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.exit_points">exit_points</a></span> /\ <span class="id"><a href="compcert.backend.Kildall.html#reachable">reachable</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.successors">successors</a></span>) (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2877')">Proof.</div>
<div class="proofscript" id="proof2877">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.reachable_exit_points">reachable_exit_points</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">x</span> [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#reachable_predecessors">reachable_predecessors</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.Exit_points">Exit_points</a></span>.<br/>
<br/>
<div class="doc">The efficient backward solver.  </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Backward_Dataflow_Solver.fixpoint">fixpoint</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.fixpoint_nodeset">DS.fixpoint_nodeset</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.successors">successors</a></span>) (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.exit_points">exit_points</a></span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Backward_Dataflow_Solver.fixpoint_solution">fixpoint_solution</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.fixpoint">fixpoint</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span> <span class="id">a</span>, <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.eq">L.eq</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#a">a</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.bot">L.bot</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2878')">Proof.</div>
<div class="proofscript" id="proof2878">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Kildall.html#make_predecessors_correct_2">make_predecessors_correct_2</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">l</span> [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id">s</span> <span class="kwd">as</span> [<span class="id">instr</span>'|] <span class="id">eqn</span>:<span class="id">CS</span>.<br/>
- <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.reachable_exit_points_predecessor">reachable_exit_points_predecessor</a></span>. <span class="id">eexact</span> <span class="id">CS</span>. <span class="tactic">intros</span> (<span class="id">ep</span> &amp; <span class="id">U</span> &amp; <span class="id">V</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.fixpoint">fixpoint</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.fixpoint_nodeset_solution">DS.fixpoint_nodeset_solution</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.ge_trans">L.ge_trans</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.bot">L.bot</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.ge_bot">L.ge_bot</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.ge_refl">L.ge_refl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.eq_sym">L.eq_sym</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The alternate solver that starts with all nodes of the CFG instead
  of just the exit points. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Backward_Dataflow_Solver.fixpoint_allnodes">fixpoint_allnodes</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.fixpoint_allnodes">DS.fixpoint_allnodes</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.successors">successors</a></span>) (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.transf">transf</a></span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Backward_Dataflow_Solver.fixpoint_allnodes_solution">fixpoint_allnodes_solution</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.fixpoint_allnodes">fixpoint_allnodes</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2879')">Proof.</div>
<div class="proofscript" id="proof2879">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Kildall.html#make_predecessors_correct_2">make_predecessors_correct_2</a></span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall.code">code</a></span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">l</span> [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.fixpoint_allnodes">fixpoint_allnodes</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.fixpoint_allnodes_solution">DS.fixpoint_allnodes_solution</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver.Kildall">Kildall</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#Backward_Dataflow_Solver">Backward_Dataflow_Solver</a></span>.<br/>
<br/>
<h1> Analysis on extended basic blocks </h1>
<br/>
<div class="doc">We now define an approximate solver for forward dataflow problems
  that proceeds by forward propagation over extended basic blocks.
  In other terms, program points with multiple predecessors are mapped
  to <span class="bracket"><span class="id">L.top</span></span> (the greatest, or coarsest, approximation) and the other
  program points are mapped to <span class="bracket"><span class="id">transf</span> <span class="id">p</span> <span class="id">X</span>[<span class="id">p</span>]</span> where <span class="bracket"><span class="id">p</span></span> is their unique
  predecessor.
  This analysis applies to any type of approximations equipped with
  an ordering and a greatest element. </div>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="ORDERED_TYPE_WITH_TOP">ORDERED_TYPE_WITH_TOP</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="ORDERED_TYPE_WITH_TOP.t">t</a></span>: <span class="kwd">Type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="ORDERED_TYPE_WITH_TOP.ge">ge</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP.t">t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP.t">t</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="ORDERED_TYPE_WITH_TOP.top">top</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="ORDERED_TYPE_WITH_TOP.top_ge">top_ge</a></span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP.ge">ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP.top">top</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="ORDERED_TYPE_WITH_TOP.refl_ge">refl_ge</a></span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP.ge">ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP">ORDERED_TYPE_WITH_TOP</a></span>.<br/>
<br/>
<div class="doc">The interface of the solver is similar to that of Kildall's forward
  solver, with a slightly different statement of the invariant
  preservation property <span class="bracket"><span class="id">fixpoint_invariant</span></span>. </div>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="BBLOCK_SOLVER">BBLOCK_SOLVER</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">Declare</span> <span class="kwd">Module</span> <span class="id"><a name="BBLOCK_SOLVER.L">L</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP">ORDERED_TYPE_WITH_TOP</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="BBLOCK_SOLVER.fixpoint">fixpoint</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) (<span class="id">successors</span>: <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">transf</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.t">L.t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.t">L.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">entrypoint</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.t">PMap.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.t">L.t</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="BBLOCK_SOLVER.fixpoint_solution">fixpoint_solution</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">successors</span> <span class="id">transf</span> <span class="id">entrypoint</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#entrypoint">entrypoint</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="BBLOCK_SOLVER.fixpoint_entry">fixpoint_entry</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">successors</span> <span class="id">transf</span> <span class="id">entrypoint</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#entrypoint">entrypoint</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#entrypoint">entrypoint</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.top">L.top</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="BBLOCK_SOLVER.fixpoint_invariant">fixpoint_invariant</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">successors</span> <span class="id">transf</span> <span class="id">entrypoint</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.t">L.t</a></span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.top">L.top</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">instr</span> <span class="id">x</span>, <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span> <span class="id">pc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER.fixpoint">fixpoint</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#entrypoint">entrypoint</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER">BBLOCK_SOLVER</a></span>.<br/>
<br/>
<div class="doc">The implementation of the ``extended basic block'' solver is a
  functor parameterized by any ordered type with a top element. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="BBlock_solver">BBlock_solver</a></span>(<span class="id">LAT</span>: <span class="id"><a href="compcert.backend.Kildall.html#ORDERED_TYPE_WITH_TOP">ORDERED_TYPE_WITH_TOP</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBLOCK_SOLVER">BBLOCK_SOLVER</a></span> <span class="kwd">with</span> <span class="kwd">Module</span> <span class="id">L</span> := <span class="id"><a href="compcert.backend.Kildall.html#LAT">LAT</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="BBlock_solver.L">L</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#LAT">LAT</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="BBlock_solver.Solver">Solver</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span>: <span class="kwd">Type</span>}.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="BBlock_solver.Solver.code">code</a></span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.A">A</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="BBlock_solver.Solver.successors">successors</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="BBlock_solver.Solver.transf">transf</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.t">L.t</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.t">L.t</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="BBlock_solver.Solver.entrypoint">entrypoint</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="BBlock_solver.Solver.P">P</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.t">L.t</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="BBlock_solver.Solver.Ptop">Ptop</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.top">L.top</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="BBlock_solver.Solver.Ptransf">Ptransf</a></span>: <span class="kwd">forall</span> <span class="id">pc</span> <span class="id">instr</span> <span class="id">x</span>, <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.P">P</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#x">x</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.bbmap">bbmap</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.result">result</a></span> := <span class="id"><a href="compcert.lib.Maps.html#PMap.t">PMap.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.t">L.t</a></span>.<br/>
<br/>
<div class="doc">As in Kildall's solver, the state of the iteration has two components:
<ul>
<li>
 A mapping from program points to values of type <span class="bracket"><span class="id">L.t</span></span> representing
  the candidate solution found so far.
</li>
<li>
 A worklist of program points that remain to be considered.
</li>
</ul>
</div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="BBlock_solver.state">state</a></span> : <span class="kwd">Type</span> := <span class="id"><a name="BBlock_solver.mkstate">mkstate</a></span><br/>
&nbsp;&nbsp;{ <span class="id"><a name="BBlock_solver.aval">aval</a></span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.result">result</a></span>; <span class="id"><a name="BBlock_solver.worklist">worklist</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> }.<br/>
<br/>
<div class="doc">The ``extended basic block'' algorithm, in pseudo-code, is as follows:
<pre>
    worklist := the set of all points n having multiple predecessors
    aval  := the mapping n -&gt; L.top

    while worklist is not empty, do
        extract a node n from worklist
        compute out = transf n aval[n]
        for each successor s of n:
            if s has only one predecessor (namely, n):
                aval[s] := out
                worklist := worklist union {s}
            end if
        end for
    end while
    return aval</pre>
*</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="BBlock_solver.propagate_successors">propagate_successors</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bb</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.bbmap">bbmap</a></span>) (<span class="id">succs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">l</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.t">L.t</a></span>) (<span class="id">st</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="kwd">struct</span> <span class="id">succs</span>} : <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#succs">succs</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span><br/>
&nbsp;&nbsp;| <span class="id">s1</span> :: <span class="id">sl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id">s1</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#propagate_successors">propagate_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id">sl</span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#propagate_successors">propagate_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id">sl</span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.set">PMap.set</a></span> <span class="id">s1</span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> :: <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span>)))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.step">step</a></span> (<span class="id">bb</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.bbmap">bbmap</a></span>) (<span class="id">st</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state">state</a></span>) : <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.result">result</a></span> + <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">_</span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)<br/>
&nbsp;&nbsp;| <span class="id">pc</span> :: <span class="id">rem</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id">pc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">_</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>) <span class="id">rem</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">instr</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">_</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors">propagate_successors</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id">instr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.transf">transf</a></span> <span class="id">pc</span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id">pc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>) <span class="id">rem</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Recognition of program points that have more than one predecessor. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.is_basic_block_head">is_basic_block_head</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">preds</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)) (<span class="id">pc</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.entrypoint">entrypoint</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Kildall.html#preds">preds</a></span>!!!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">s</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">s</span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> :: <span class="id">_</span> :: <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.basic_block_map">basic_block_map</a></span> : <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.bbmap">bbmap</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.is_basic_block_head">is_basic_block_head</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.basic_block_list">basic_block_list</a></span> (<span class="id">bb</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.bbmap">bbmap</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Maps.html#PTree.fold">PTree.fold</a></span> (<span class="kwd">fun</span> <span class="id">l</span> <span class="id">pc</span> <span class="id">instr</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="kwd">then</span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> :: <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> <span class="kwd">else</span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<br/>
<div class="doc">The computation of the approximate solution. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.fixpoint">fixpoint</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.result">result</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">bb</span> := <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Iteration.html#PrimIter.iterate">PrimIter.iterate</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.step">step</a></span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span>) (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.init">PMap.init</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.top">L.top</a></span>) (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_list">basic_block_list</a></span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span>)).<br/>
<br/>
<h2> Properties of predecessors and multiple-predecessors nodes </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.predecessors">predecessors</a></span> := <span class="id"><a href="compcert.backend.Kildall.html#make_predecessors">make_predecessors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.predecessors_correct">predecessors_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>!!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2880')">Proof.</div>
<div class="proofscript" id="proof2880">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#make_predecessors_correct_1">make_predecessors_correct_1</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.multiple_predecessors">multiple_predecessors</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">n1</span> <span class="id">instr1</span> <span class="id">n2</span> <span class="id">instr2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n1">n1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr1">instr1</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr1">instr1</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n2">n2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr2">instr2</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr2">instr2</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#n1">n1</a></span> &lt;&gt; <span class="id"><a href="compcert.backend.Kildall.html#n2">n2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2881')">Proof.</div>
<div class="proofscript" id="proof2881">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">n1</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>!!!<span class="id">s</span>). <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors_correct">predecessors_correct</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">n2</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>!!!<span class="id">s</span>). <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors_correct">predecessors_correct</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.is_basic_block_head">is_basic_block_head</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">s</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.entrypoint">entrypoint</a></span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">fold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>!!!<span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#proj_sumbool_is_true">proj_sumbool_is_true</a></span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.no_self_loop">no_self_loop</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">instr</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2882')">Proof.</div>
<div class="proofscript" id="proof2882">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.is_basic_block_head">is_basic_block_head</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.entrypoint">entrypoint</a></span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">fold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors_correct">predecessors_correct</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>!!!<span class="id">n</span>).<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#proj_sumbool_is_true">proj_sumbool_is_true</a></span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Correctness invariant </h2>
<br/>
<div class="doc">The invariant over the state is as follows:
<ul>
<li>
 Points with several predecessors are mapped to <span class="bracket"><span class="id">L.top</span></span>
</li>
<li>
 Points not in the worklist satisfy their inequations
  (as in Kildall's algorithm).
</li>
</ul>
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.state_invariant">state_invariant</a></span> (<span class="id">st</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state">state</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.top">L.top</a></span>)<br/>
/\<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span>) \/<br/>
&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">instr</span> <span class="id">s</span>, <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>))).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.propagate_successors_charact1">propagate_successors_charact1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bb</span> <span class="id">succs</span> <span class="id">l</span> <span class="id">st</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors">propagate_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id"><a href="compcert.backend.Kildall.html#succs">succs</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>).(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2883')">Proof.</div>
<div class="proofscript" id="proof2883">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">succs</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">case</span> (<span class="id">bb</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id">a</span> :: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span> <span class="id">st</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tl">incl_tl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">st1</span> := (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.set">PMap.set</a></span> <span class="id">a</span> <span class="id">l</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span> <span class="id">st</span>)) (<span class="id">a</span> :: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span> <span class="id">st</span>))).<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">a</span> :: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span> <span class="id">st</span>) <span class="kwd">with</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span> <span class="id">st1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.propagate_successors_charact2">propagate_successors_charact2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bb</span> <span class="id">succs</span> <span class="id">l</span> <span class="id">st</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st</span>' := <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors">propagate_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id"><a href="compcert.backend.Kildall.html#succs">succs</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#succs">succs</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span>) /\ <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span>)<br/>
/\ (~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#succs">succs</a></span> \/ <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">st</span>'.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2884')">Proof.</div>
<div class="proofscript" id="proof2884">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">succs</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Base&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">tauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Inductive&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">caseEq</span> (<span class="id">bb</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">IHsuccs</span> <span class="id">l</span> <span class="id">st</span> <span class="id">n</span>); <span class="tactic">intros</span> <span class="id">U</span> <span class="id">V</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">U</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intro</span>. <span class="tactic">subst</span> <span class="id">a</span>. <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">V</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">st1</span> := <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.set">PMap.set</a></span> <span class="id">a</span> <span class="id">l</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span> <span class="id">st</span>)) (<span class="id">a</span> :: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span> <span class="id">st</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">IHsuccs</span> <span class="id">l</span> <span class="id">st1</span> <span class="id">n</span>); <span class="tactic">intros</span> <span class="id">U</span> <span class="id">V</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">n</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors_charact1">propagate_successors_charact1</a></span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">case</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_dec">In_dec</a></span> <span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">a</span> <span class="id">succs</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">U</span> <span class="id">i</span> <span class="id">H1</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">V</span>. <span class="tactic">unfold</span> <span class="id">st1</span>; <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">U</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">V</span>. <span class="tactic">unfold</span> <span class="id">st1</span>; <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.gso">PMap.gso</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">n</span>. <span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intro</span>. <span class="tactic">tauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.propagate_successors_invariant">propagate_successors_invariant</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">instr</span> <span class="id">res</span> <span class="id">rem</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> :: <span class="id"><a href="compcert.backend.Kildall.html#rem">rem</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors">propagate_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> <span class="id"><a href="compcert.backend.Kildall.html#rem">rem</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2885')">Proof.</div>
<div class="proofscript" id="proof2885">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">rem</span>. <span class="tactic">intros</span> <span class="id">CODE</span> [<span class="id">INV1</span> <span class="id">INV2</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">INV1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">INV2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">l</span> := <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.transf">transf</a></span> <span class="id">pc</span> <span class="id">res</span>!!<span class="id">pc</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors_charact1">propagate_successors_charact1</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id">instr</span>) <span class="id">l</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id">res</span> <span class="id">rem</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors_charact2">propagate_successors_charact2</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id">instr</span>) <span class="id">l</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id">res</span> <span class="id">rem</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">st1</span> := <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors">propagate_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id">instr</span>) <span class="id">l</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id">res</span> <span class="id">rem</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">U</span> <span class="id">V</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">U</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;part:&nbsp;BB&nbsp;entries&nbsp;remain&nbsp;at&nbsp;top&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">U</span> <span class="id">n</span>); <span class="tactic">intros</span> <span class="id">C</span> <span class="id">D</span>. <span class="tactic">rewrite</span> <span class="id">D</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">INV1</span>. <span class="tactic">auto</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Second&nbsp;part:&nbsp;monotonicity&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;1:&nbsp;n&nbsp;=&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">pc</span> <span class="id">n</span>). <span class="tactic">subst</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">instr0</span> = <span class="id">instr</span>) <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">subst</span> <span class="id">instr0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">U</span> <span class="id">s</span>); <span class="tactic">intros</span> <span class="id">C</span> <span class="id">D</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">st1</span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id">pc</span>) <span class="kwd">with</span> <span class="id">res</span>!!<span class="id">pc</span>. <span class="id">fold</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span> <span class="id">s</span>) <span class="id">eqn</span>:<span class="id">BB</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">D</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">INV1</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.top_ge">L.top_ge</a></span>. <span class="tactic">auto</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">C</span> <span class="id">H0</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span> <span class="id">_</span>)). <span class="tactic">intros</span> <span class="id">X</span> <span class="id">Y</span>. <span class="tactic">rewrite</span> <span class="id">Y</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.refl_ge">L.refl_ge</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">U</span> <span class="id">pc</span>); <span class="tactic">intros</span> <span class="id">E</span> <span class="id">F</span>. <span class="tactic">rewrite</span> <span class="id">F</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_dec">In_dec</a></span> <span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">pc</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id">instr</span>)).<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.no_self_loop">no_self_loop</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;2:&nbsp;n&nbsp;&lt;&gt;&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">INV2</span> <span class="id">n</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;2.1:&nbsp;n&nbsp;was&nbsp;already&nbsp;in&nbsp;worklist,&nbsp;still&nbsp;is&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">apply</span> <span class="id">V</span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;2.2:&nbsp;n&nbsp;was&nbsp;not&nbsp;in&nbsp;worklist&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">INV3</span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">instr</span>', <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">instr</span>' -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id">instr</span>') -&gt; <span class="id">st1</span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id">res</span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Amazingly,&nbsp;successors&nbsp;of&nbsp;n&nbsp;do&nbsp;not&nbsp;change.&nbsp;&nbsp;The&nbsp;only&nbsp;way<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;they&nbsp;could&nbsp;change&nbsp;is&nbsp;if&nbsp;they&nbsp;were&nbsp;successors&nbsp;of&nbsp;pc&nbsp;as&nbsp;well,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;that&nbsp;gives&nbsp;them&nbsp;two&nbsp;different&nbsp;predecessors,&nbsp;so<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;they&nbsp;are&nbsp;basic&nbsp;block&nbsp;heads,&nbsp;and&nbsp;thus&nbsp;do&nbsp;not&nbsp;change!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">elim</span> (<span class="id">U</span> <span class="id">s</span>); <span class="tactic">intros</span> <span class="id">C</span> <span class="id">D</span>. <span class="tactic">rewrite</span> <span class="id">D</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_dec">In_dec</a></span> <span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">s</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id">instr</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.multiple_predecessors">multiple_predecessors</a></span> <span class="kwd">with</span> (<span class="id">n1</span> := <span class="id">pc</span>) (<span class="id">n2</span> := <span class="id">n</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_dec">In_dec</a></span> <span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id">instr</span>)).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;2.2.1:&nbsp;n&nbsp;is&nbsp;a&nbsp;successor&nbsp;of&nbsp;pc.&nbsp;Either&nbsp;it&nbsp;is&nbsp;in&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;worklist&nbsp;or&nbsp;it&nbsp;did&nbsp;not&nbsp;change&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span> <span class="id">n</span>) <span class="id">eqn</span>:<span class="id">BB</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">U</span> <span class="id">n</span>); <span class="tactic">intros</span> <span class="id">C</span> <span class="id">D</span>. <span class="tactic">rewrite</span> <span class="id">D</span>. <span class="id">erewrite</span> <span class="id">INV3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">elim</span> (<span class="id">U</span> <span class="id">n</span>); <span class="tactic">intros</span> <span class="id">C</span> <span class="id">D</span>. <span class="tactic">elim</span> (<span class="id">C</span> <span class="id">i</span> <span class="id">BB</span>); <span class="tactic">intros</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;2.2.2:&nbsp;n&nbsp;is&nbsp;not&nbsp;a&nbsp;successor&nbsp;of&nbsp;pc.&nbsp;It&nbsp;did&nbsp;not&nbsp;change.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">U</span> <span class="id">n</span>); <span class="tactic">intros</span> <span class="id">C</span> <span class="id">D</span>. <span class="tactic">rewrite</span> <span class="id">D</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">INV3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.propagate_successors_invariant_2">propagate_successors_invariant_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">res</span> <span class="id">rem</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> :: <span class="id"><a href="compcert.backend.Kildall.html#rem">rem</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> <span class="id"><a href="compcert.backend.Kildall.html#rem">rem</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2886')">Proof.</div>
<div class="proofscript" id="proof2886">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">rem</span>. <span class="tactic">intros</span> <span class="id">CODE</span> [<span class="id">INV1</span> <span class="id">INV2</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">INV1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">INV2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">INV1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">INV2</span> <span class="id">n</span>) <span class="kwd">as</span> [[<span class="id">U</span> | <span class="id">U</span>] | <span class="id">U</span>].<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">n</span>. <span class="id">right</span>; <span class="tactic">intros</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.initial_state_invariant">initial_state_invariant</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PMap.init">PMap.init</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.top">L.top</a></span>) (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_list">basic_block_list</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2887')">Proof.</div>
<div class="proofscript" id="proof2887">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.gi">PMap.gi</a></span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">intros</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.gi">PMap.gi</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.top_ge">L.top_ge</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.analyze_invariant">analyze_invariant</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.fixpoint">fixpoint</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2888')">Proof.</div>
<div class="proofscript" id="proof2888">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.fixpoint">fixpoint</a></span>; <span class="tactic">intros</span>. <span class="tactic">pattern</span> <span class="id">res</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="compcert.lib.Iteration.html#PrimIter.iterate_prop">PrimIter.iterate_prop</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.step">step</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">st</span> <span class="id">INV</span>. <span class="tactic">destruct</span> <span class="id">st</span> <span class="kwd">as</span> [<span class="id">stin</span> <span class="id">stwrk</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.step">step</a></span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">stwrk</span> <span class="kwd">as</span> [ | <span class="id">pc</span> <span class="id">rem</span> ] <span class="id">eqn</span>:<span class="id">WRK</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id">pc</span>) <span class="kwd">as</span> [<span class="id">instr</span>|] <span class="id">eqn</span>:<span class="id">CODE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors_invariant">propagate_successors_invariant</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors_invariant_2">propagate_successors_invariant_2</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.initial_state_invariant">initial_state_invariant</a></span>.<br/>
Qed.</div>
<br/>
<h2> Correctness of the returned solution </h2>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="BBlock_solver.fixpoint_solution">fixpoint_solution</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span> <span class="id">n</span> <span class="id">instr</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.fixpoint">fixpoint</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.successors">successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.ge">L.ge</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.transf">transf</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2889')">Proof.</div>
<div class="proofscript" id="proof2889">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id">res</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.analyze_invariant">analyze_invariant</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H2</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">H4</span> <span class="id">n</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="BBlock_solver.fixpoint_entry">fixpoint_entry</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.fixpoint">fixpoint</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.entrypoint">entrypoint</a></span> = <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.top">L.top</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2890')">Proof.</div>
<div class="proofscript" id="proof2890">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state_invariant">state_invariant</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id">res</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.analyze_invariant">analyze_invariant</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span>, <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.is_basic_block_head">is_basic_block_head</a></span>.<br/>
&nbsp;&nbsp;<span class="id">fold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.predecessors">predecessors</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#peq_true">peq_true</a></span>.<br/>
Qed.</div>
<br/>
<h2> Preservation of a property over solutions </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="BBlock_solver.Pstate">Pstate</a></span> (<span class="id">st</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.state">state</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span>, <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>)!!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BBlock_solver.propagate_successors_P">propagate_successors_P</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bb</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">succs</span> <span class="id">st</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Pstate">Pstate</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Pstate">Pstate</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors">propagate_successors</a></span> <span class="id"><a href="compcert.backend.Kildall.html#bb">bb</a></span> <span class="id"><a href="compcert.backend.Kildall.html#succs">succs</a></span> <span class="id"><a href="compcert.backend.Kildall.html#l">l</a></span> <span class="id"><a href="compcert.backend.Kildall.html#st">st</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2891')">Proof.</div>
<div class="proofscript" id="proof2891">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">succs</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">case</span> (<span class="id">bb</span> <span class="id">a</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHsuccs</span>. <span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">case</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">pc</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H0</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="BBlock_solver.fixpoint_invariant">fixpoint_invariant</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span> <span class="id">pc</span>, <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.fixpoint">fixpoint</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.P">P</a></span> <span class="id"><a href="compcert.backend.Kildall.html#res">res</a></span>!!<span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2892')">Proof.</div>
<div class="proofscript" id="proof2892">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.fixpoint">fixpoint</a></span>; <span class="tactic">intros</span>. <span class="tactic">pattern</span> <span class="id">res</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="compcert.lib.Iteration.html#PrimIter.iterate_prop">PrimIter.iterate_prop</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.step">step</a></span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.basic_block_map">basic_block_map</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Pstate">Pstate</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">st</span> <span class="id">PS</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.step">step</a></span>. <span class="tactic">destruct</span> (<span class="id">st</span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.worklist">worklist</a></span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">PS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">PS2</span>: <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Pstate">Pstate</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.mkstate">mkstate</a></span> <span class="id">st</span>.(<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.aval">aval</a></span>) <span class="id">l</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intro</span>; <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">PS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.code">code</a></span>!<span class="id">p</span>) <span class="kwd">as</span> [<span class="id">instr</span>|] <span class="id">eqn</span>:<span class="id">CODE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.propagate_successors_P">propagate_successors_P</a></span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intro</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PMap.gi">PMap.gi</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver.Ptop">Ptop</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver.Solver">Solver</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#BBlock_solver">BBlock_solver</a></span>.<br/>
<br/>
<h2> Node sets </h2>
<br/>
<div class="doc">We now define implementations of the <span class="bracket"><span class="id">NODE_SET</span></span> interface
  appropriate for forward and backward dataflow analysis.
  As mentioned earlier, we aim for a traversal of the CFG nodes
  in reverse postorder (for forward analysis) or postorder
  (for backward analysis).  We take advantage of the following
  fact, valid for all CFG generated by translation from Cminor:
  the enumeration <span class="bracket"><span class="id">n</span>-1</span>, <span class="bracket"><span class="id">n</span>-2</span>, ..., 3, 2, 1 where <span class="bracket"><span class="id">n</span></span> is the
  top CFG node is a reverse postorder traversal.
  Therefore, for forward analysis, we will use an implementation
  of <span class="bracket"><span class="id">NODE_SET</span></span> where the <span class="bracket"><span class="id">pick</span></span> operation selects the
  greatest node in the working list.  For backward analysis,
  we will similarly pick the smallest node in the working list. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Heaps.html">Heaps</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="NodeSetForward">NodeSetForward</a></span> &lt;: <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET">NODE_SET</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetForward.t">t</a></span> := <span class="id"><a href="compcert.lib.Heaps.html#PHeap.t">PHeap.t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetForward.empty">empty</a></span> := <span class="id"><a href="compcert.lib.Heaps.html#PHeap.empty">PHeap.empty</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetForward.add">add</a></span> (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">s</span>: <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.t">t</a></span>) : <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.t">t</a></span> := <span class="id"><a href="compcert.lib.Heaps.html#PHeap.insert">PHeap.insert</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetForward.pick">pick</a></span> (<span class="id">s</span>: <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.t">t</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Heaps.html#PHeap.findMax">PHeap.findMax</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">n</span>, <span class="id"><a href="compcert.lib.Heaps.html#PHeap.deleteMax">PHeap.deleteMax</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetForward.all_nodes">all_nodes</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Maps.html#PTree.fold">PTree.fold</a></span> (<span class="kwd">fun</span> <span class="id">s</span> <span class="id">pc</span> <span class="id">instr</span> =&gt; <span class="id"><a href="compcert.lib.Heaps.html#PHeap.insert">PHeap.insert</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.lib.Heaps.html#PHeap.empty">PHeap.empty</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetForward.In">In</a></span> := <span class="id"><a href="compcert.lib.Heaps.html#PHeap.In">PHeap.In</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetForward.empty_spec">empty_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, ~<span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.empty">empty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2893')">Proof.</div>
<div class="proofscript" id="proof2893">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Heaps.html#PHeap.In_empty">PHeap.In_empty</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetForward.add_spec">add_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">n</span>' <span class="id">s</span>, <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span> <span class="id">n</span>' (<span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.add">add</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>) &lt;-&gt; <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id">n</span>' \/ <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2894')">Proof.</div>
<div class="proofscript" id="proof2894">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Heaps.html#PHeap.In_insert">PHeap.In_insert</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetForward.pick_none">pick_none</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.pick">pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; ~<span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2895')">Proof.</div>
<div class="proofscript" id="proof2895">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">n</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.pick">pick</a></span>. <span class="id">caseEq</span> (<span class="id"><a href="compcert.lib.Heaps.html#PHeap.findMax">PHeap.findMax</a></span> <span class="id">s</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Heaps.html#PHeap.findMax_empty">PHeap.findMax_empty</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetForward.pick_some">pick_some</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">n</span> <span class="id">s</span>', <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.pick">pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>, <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> &lt;-&gt; <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id">n</span>' \/ <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span> <span class="id">n</span>' <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2896')">Proof.</div>
<div class="proofscript" id="proof2896">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">s</span>'; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.pick">pick</a></span>. <span class="id">caseEq</span> (<span class="id"><a href="compcert.lib.Heaps.html#PHeap.findMax">PHeap.findMax</a></span> <span class="id">s</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.lib.Heaps.html#PHeap.In_deleteMax">PHeap.In_deleteMax</a></span> <span class="id">s</span> <span class="id">n</span> <span class="id">n</span>' <span class="id">H</span>). <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetForward.all_nodes_spec">all_nodes_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">n</span> <span class="id">instr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.all_nodes">all_nodes</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2897')">Proof.</div>
<div class="proofscript" id="proof2897">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">code</span> <span class="id">n</span> <span class="id">instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Maps.html#PTree_Properties.fold_rec">PTree_Properties.fold_rec</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">m</span> <span class="tactic">set</span> =&gt; <span class="id"><a href="compcert.backend.Kildall.html#m">m</a></span>!<span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">instr</span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.In">In</a></span> <span class="id">n</span> <span class="tactic">set</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;extensionality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;base&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;inductive&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.add_spec">add_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">n</span> <span class="id">k</span>). <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward">NodeSetForward</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="NodeSetBackward">NodeSetBackward</a></span> &lt;: <span class="id"><a href="compcert.backend.Kildall.html#NODE_SET">NODE_SET</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetBackward.t">t</a></span> := <span class="id"><a href="compcert.lib.Heaps.html#PHeap.t">PHeap.t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetBackward.empty">empty</a></span> := <span class="id"><a href="compcert.lib.Heaps.html#PHeap.empty">PHeap.empty</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetBackward.add">add</a></span> (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">s</span>: <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.t">t</a></span>) : <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.t">t</a></span> := <span class="id"><a href="compcert.lib.Heaps.html#PHeap.insert">PHeap.insert</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetBackward.pick">pick</a></span> (<span class="id">s</span>: <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.t">t</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Heaps.html#PHeap.findMin">PHeap.findMin</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">n</span>, <span class="id"><a href="compcert.lib.Heaps.html#PHeap.deleteMin">PHeap.deleteMin</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetBackward.all_nodes">all_nodes</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Maps.html#PTree.fold">PTree.fold</a></span> (<span class="kwd">fun</span> <span class="id">s</span> <span class="id">pc</span> <span class="id">instr</span> =&gt; <span class="id"><a href="compcert.lib.Heaps.html#PHeap.insert">PHeap.insert</a></span> <span class="id"><a href="compcert.backend.Kildall.html#pc">pc</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>) <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span> <span class="id"><a href="compcert.lib.Heaps.html#PHeap.empty">PHeap.empty</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NodeSetBackward.In">In</a></span> := <span class="id"><a href="compcert.lib.Heaps.html#PHeap.In">PHeap.In</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetBackward.empty_spec">empty_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, ~<span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.empty">empty</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Proof</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.empty_spec">NodeSetForward.empty_spec</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetBackward.add_spec">add_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">n</span>' <span class="id">s</span>, <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.In">In</a></span> <span class="id">n</span>' (<span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.add">add</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>) &lt;-&gt; <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id">n</span>' \/ <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.In">In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Proof</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.add_spec">NodeSetForward.add_spec</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetBackward.pick_none">pick_none</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">n</span>, <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.pick">pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; ~<span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2898')">Proof.</div>
<div class="proofscript" id="proof2898">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">n</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.pick">pick</a></span>. <span class="id">caseEq</span> (<span class="id"><a href="compcert.lib.Heaps.html#PHeap.findMin">PHeap.findMin</a></span> <span class="id">s</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Heaps.html#PHeap.findMin_empty">PHeap.findMin_empty</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetBackward.pick_some">pick_some</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">n</span> <span class="id">s</span>', <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.pick">pick</a></span> <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span>, <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>', <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.In">In</a></span> <span class="id">n</span>' <span class="id"><a href="compcert.backend.Kildall.html#s">s</a></span> &lt;-&gt; <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id">n</span>' \/ <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.In">In</a></span> <span class="id">n</span>' <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2899')">Proof.</div>
<div class="proofscript" id="proof2899">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">s</span>'; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.pick">pick</a></span>. <span class="id">caseEq</span> (<span class="id"><a href="compcert.lib.Heaps.html#PHeap.findMin">PHeap.findMin</a></span> <span class="id">s</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.lib.Heaps.html#PHeap.In_deleteMin">PHeap.In_deleteMin</a></span> <span class="id">s</span> <span class="id">n</span> <span class="id">n</span>' <span class="id">H</span>). <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.In">In</a></span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NodeSetBackward.all_nodes_spec">all_nodes_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">code</span>: <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="compcert.backend.Kildall.html#A">A</a></span>) <span class="id">n</span> <span class="id">instr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>!<span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Kildall.html#instr">instr</a></span> -&gt; <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.In">In</a></span> <span class="id"><a href="compcert.backend.Kildall.html#n">n</a></span> (<span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward.all_nodes">all_nodes</a></span> <span class="id"><a href="compcert.backend.Kildall.html#code">code</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Proof</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetForward.all_nodes_spec">NodeSetForward.all_nodes_spec</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Kildall.html#NodeSetBackward">NodeSetBackward</a></span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
