
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Cminorgen</title>
<meta name="description" content="Documentation of Coq module Cminorgen" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Cminorgen</h1>
<div class="coq">
<br/>
<div class="doc">Translation from Csharpminor to Cminor. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FSets.html">FSets</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FSetAVL.html">FSetAVL</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Structures.Orders.html">Orders</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Mergesort.html">Mergesort</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Coqlib.html">Coqlib</a></span> <span class="id"><a href="compcert.lib.Maps.html">Maps</a></span> <span class="id"><a href="compcert.lib.Ordered.html">Ordered</a></span> <span class="id"><a href="compcert.common.Errors.html">Errors</a></span> <span class="id"><a href="compcert.lib.Integers.html">Integers</a></span> <span class="id"><a href="compcert.lib.Floats.html">Floats</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.AST.html">AST</a></span> <span class="id"><a href="compcert.common.Linking.html">Linking</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.cfrontend.Csharpminor.html">Csharpminor</a></span> <span class="id"><a href="compcert.backend.Cminor.html">Cminor</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">error_monad_scope</span>.<br/>
<br/>
<div class="doc">The main task in translating Csharpminor to Cminor is to explicitly
  stack-allocate local variables whose address is taken: these local
  variables become sub-blocks of the Cminor stack data block for the
  current function.  Taking the address of such a variable becomes
  a <span class="bracket"><span class="id">Oaddrstack</span></span> operation with the corresponding offset.  Accessing
  or assigning such a variable becomes a load or store operation at
  that address.  Only scalar local variables whose address is never
  taken in the Csharpminor code can be mapped to Cminor local
  variable, since the latter do not reside in memory.
  Another task performed during the translation to Cminor is to
  transform the Clight-like <span class="bracket"><span class="id">switch</span></span> construct of Csharpminor
  into the simpler, lower-level <span class="bracket"><span class="id">switch</span></span> constructs of Cminor.
</div>
<br/>
<h1> Handling of variables </h1>
<br/>
<div class="doc">To every Csharpminor variable, the compiler associates its offset
  in the Cminor stack data block. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="compilenv">compilenv</a></span> := <span class="id"><a href="compcert.lib.Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>.<br/>
<br/>
<div class="doc">Generation of a Cminor expression for taking the address of
  a Csharpminor variable. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="var_addr">var_addr</a></span> (<span class="id">cenv</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span>) (<span class="id">id</span>: <span class="id"><a href="compcert.common.AST.html#ident">ident</a></span>): <span class="id"><a href="compcert.backend.Cminor.html#expr">expr</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.get">PTree.get</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#id">id</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ofs</span> =&gt; <span class="id"><a href="compcert.backend.Cminor.html#Econst">Econst</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Oaddrstack">Oaddrstack</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">ofs</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>     =&gt; <span class="id"><a href="compcert.backend.Cminor.html#Econst">Econst</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Oaddrsymbol">Oaddrsymbol</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#id">id</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h1> Translation of expressions and statements. </h1>
<br/>
<div class="doc">Translation of constants. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="transl_constant">transl_constant</a></span> (<span class="id">cst</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#constant">Csharpminor.constant</a></span>): <span class="id"><a href="compcert.backend.Cminor.html#constant">constant</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cst">cst</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Ointconst">Csharpminor.Ointconst</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Cminor.html#Ointconst">Ointconst</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Ofloatconst">Csharpminor.Ofloatconst</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Cminor.html#Ofloatconst">Ofloatconst</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Osingleconst">Csharpminor.Osingleconst</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Cminor.html#Osingleconst">Osingleconst</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Olongconst">Csharpminor.Olongconst</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Cminor.html#Olongconst">Olongconst</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Translation of expressions.  </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="transl_expr">transl_expr</a></span> (<span class="id">cenv</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span>) (<span class="id">e</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#expr">Csharpminor.expr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="kwd">struct</span> <span class="id">e</span>}: <span class="id"><a href="compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="compcert.backend.Cminor.html#expr">expr</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#e">e</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Evar">Csharpminor.Evar</a></span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Evar">Evar</a></span> <span class="id">id</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Eaddrof">Csharpminor.Eaddrof</a></span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#var_addr">var_addr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">id</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Econst">Csharpminor.Econst</a></span> <span class="id">cst</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Econst">Econst</a></span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_constant">transl_constant</a></span> <span class="id">cst</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Eunop">Csharpminor.Eunop</a></span> <span class="id">op</span> <span class="id">e1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te1</span>  &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Eunop">Eunop</a></span> <span class="id">op</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te1">te1</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Ebinop">Csharpminor.Ebinop</a></span> <span class="id">op</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te1</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te2</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Ebinop">Ebinop</a></span> <span class="id">op</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te1">te1</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te2">te2</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Eload">Csharpminor.Eload</a></span> <span class="id">chunk</span> <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#e">e</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Eload">Eload</a></span> <span class="id">chunk</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te">te</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="transl_exprlist">transl_exprlist</a></span> (<span class="id">cenv</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span>) (<span class="id">el</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.cfrontend.Csharpminor.html#expr">Csharpminor.expr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="kwd">struct</span> <span class="id">el</span>}: <span class="id"><a href="compcert.common.Errors.html#res">res</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Cminor.html#expr">expr</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#el">el</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;| <span class="id">e1</span> :: <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te1</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te2</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_exprlist">transl_exprlist</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#te1">te1</a></span> :: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te2">te2</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">To translate <span class="bracket"><span class="id">switch</span></span> statements, we wrap the statements associated with
  the various cases in a cascade of nested Cminor blocks.
  The multi-way branch is performed by a Cminor <span class="bracket"><span class="id">switch</span></span>
  statement that exits to the appropriate case.  For instance:
<pre>
switch (e) {        ---&gt;    block { block { block {
  case N1: s1;                switch (e) { N1: exit 0; N2: exit 1; default: exit 2; }
  case N2: s2;                } ; s1  // with exits shifted by 2
  default: s;                 } ; s2  // with exits shifted by 1
}                             } ; s   // with exits unchanged</pre>
  To shift <span class="bracket"><span class="id">exit</span></span> statements appropriately, we use a second
  compile-time environment, of type <span class="bracket"><span class="id">exit_env</span></span>, which
  records the blocks inserted during the translation.
  A <span class="bracket"><span class="id">true</span></span> element means the block was present in the original code;
  a <span class="bracket"><span class="id">false</span></span> element, that it was inserted during translation.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="exit_env">exit_env</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="shift_exit">shift_exit</a></span> (<span class="id">e</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#exit_env">exit_env</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) {<span class="kwd">struct</span> <span class="id">e</span>} : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#e">e</a></span>, <span class="id"><a href="compcert.cfrontend.Cminorgen.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="compcert.cfrontend.Cminorgen.html#n">n</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> :: <span class="id">e</span>', <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#shift_exit">shift_exit</a></span> <span class="id">e</span>' <span class="id"><a href="compcert.cfrontend.Cminorgen.html#n">n</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> :: <span class="id">e</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> :: <span class="id">e</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#shift_exit">shift_exit</a></span> <span class="id">e</span>' <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="switch_table">switch_table</a></span> (<span class="id">ls</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#lbl_stmt">lbl_stmt</a></span>) (<span class="id">k</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) {<span class="kwd">struct</span> <span class="id">ls</span>} : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ls">ls</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#LSnil">LSnil</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="compcert.cfrontend.Cminorgen.html#k">k</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#LScons">LScons</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id">_</span> <span class="id">rem</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">tbl</span>, <span class="id">dfl</span>) := <span class="id"><a href="compcert.cfrontend.Cminorgen.html#switch_table">switch_table</a></span> <span class="id">rem</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#k">k</a></span>) <span class="kwd">in</span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#tbl">tbl</a></span>, <span class="id"><a href="compcert.cfrontend.Cminorgen.html#k">k</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#LScons">LScons</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ni</span>) <span class="id">_</span> <span class="id">rem</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">tbl</span>, <span class="id">dfl</span>) := <span class="id"><a href="compcert.cfrontend.Cminorgen.html#switch_table">switch_table</a></span> <span class="id">rem</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#k">k</a></span>) <span class="kwd">in</span> ((<span class="id">ni</span>, <span class="id"><a href="compcert.cfrontend.Cminorgen.html#k">k</a></span>) :: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#tbl">tbl</a></span>, <span class="id"><a href="compcert.cfrontend.Cminorgen.html#dfl">dfl</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="switch_env">switch_env</a></span> (<span class="id">ls</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#lbl_stmt">lbl_stmt</a></span>) (<span class="id">e</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#exit_env">exit_env</a></span>) {<span class="kwd">struct</span> <span class="id">ls</span>}: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#exit_env">exit_env</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ls">ls</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#LSnil">LSnil</a></span> =&gt; <span class="id"><a href="compcert.cfrontend.Cminorgen.html#e">e</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#LScons">LScons</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">ls</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> :: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#switch_env">switch_env</a></span> <span class="id">ls</span>' <span class="id"><a href="compcert.cfrontend.Cminorgen.html#e">e</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Translation of statements.  The nonobvious part is
  the translation of <span class="bracket"><span class="id">switch</span></span> statements, outlined above. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="transl_stmt">transl_stmt</a></span> (<span class="id">cenv</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span>) (<span class="id">xenv</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#exit_env">exit_env</a></span>) (<span class="id">s</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#stmt">Csharpminor.stmt</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="kwd">struct</span> <span class="id">s</span>}: <span class="id"><a href="compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="compcert.backend.Cminor.html#stmt">stmt</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#s">s</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sskip">Csharpminor.Sskip</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Cminor.html#Sskip">Sskip</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sset">Csharpminor.Sset</a></span> <span class="id">id</span> <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sassign">Sassign</a></span> <span class="id">id</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te">te</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sstore">Csharpminor.Sstore</a></span> <span class="id">chunk</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te1</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te2</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sstore">Sstore</a></span> <span class="id">chunk</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te1">te1</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te2">te2</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Scall">Csharpminor.Scall</a></span> <span class="id">optid</span> <span class="id">sig</span> <span class="id">e</span> <span class="id">el</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">tel</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_exprlist">transl_exprlist</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">el</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Scall">Scall</a></span> <span class="id">optid</span> <span class="id">sig</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te">te</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#tel">tel</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sbuiltin">Csharpminor.Sbuiltin</a></span> <span class="id">optid</span> <span class="id">ef</span> <span class="id">el</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">tel</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_exprlist">transl_exprlist</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">el</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sbuiltin">Sbuiltin</a></span> <span class="id">optid</span> <span class="id">ef</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#tel">tel</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sseq">Csharpminor.Sseq</a></span> <span class="id">s1</span> <span class="id">s2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts1</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts2</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span> <span class="id">s2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sseq">Sseq</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ts1">ts1</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ts2">ts2</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sifthenelse">Csharpminor.Sifthenelse</a></span> <span class="id">e</span> <span class="id">s1</span> <span class="id">s2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts1</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts2</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span> <span class="id">s2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sifthenelse">Sifthenelse</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te">te</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ts1">ts1</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ts2">ts2</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sloop">Csharpminor.Sloop</a></span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#s">s</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sloop">Sloop</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ts">ts</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sblock">Csharpminor.Sblock</a></span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> :: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span>) <span class="id"><a href="compcert.cfrontend.Cminorgen.html#s">s</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sblock">Sblock</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ts">ts</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sexit">Csharpminor.Sexit</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sexit">Sexit</a></span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#shift_exit">shift_exit</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sswitch">Csharpminor.Sswitch</a></span> <span class="id">long</span> <span class="id">e</span> <span class="id">ls</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">tbl</span>, <span class="id">dfl</span>) := <span class="id"><a href="compcert.cfrontend.Cminorgen.html#switch_table">switch_table</a></span> <span class="id">ls</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_lblstmt">transl_lblstmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#switch_env">switch_env</a></span> <span class="id">ls</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span>) <span class="id">ls</span> (<span class="id"><a href="compcert.backend.Cminor.html#Sswitch">Sswitch</a></span> <span class="id">long</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te">te</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#tbl">tbl</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#dfl">dfl</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sreturn">Csharpminor.Sreturn</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sreturn">Sreturn</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sreturn">Csharpminor.Sreturn</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">e</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_expr">transl_expr</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sreturn">Sreturn</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#te">te</a></span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Slabel">Csharpminor.Slabel</a></span> <span class="id">lbl</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#s">s</a></span>; <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Slabel">Slabel</a></span> <span class="id">lbl</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ts">ts</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#Sgoto">Csharpminor.Sgoto</a></span> <span class="id">lbl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sgoto">Sgoto</a></span> <span class="id">lbl</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
<span class="kwd">with</span> <span class="id"><a name="transl_lblstmt">transl_lblstmt</a></span> (<span class="id">cenv</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span>) (<span class="id">xenv</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#exit_env">exit_env</a></span>) (<span class="id">ls</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#lbl_stmt">Csharpminor.lbl_stmt</a></span>) (<span class="id">body</span>: <span class="id"><a href="compcert.backend.Cminor.html#stmt">stmt</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="kwd">struct</span> <span class="id">ls</span>}: <span class="id"><a href="compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="compcert.backend.Cminor.html#stmt">stmt</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ls">ls</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#LSnil">Csharpminor.LSnil</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sseq">Sseq</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sblock">Sblock</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#body">body</a></span>) <span class="id"><a href="compcert.backend.Cminor.html#Sskip">Sskip</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.cfrontend.Csharpminor.html#LScons">Csharpminor.LScons</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">ls</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_lblstmt">transl_lblstmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#tail">List.tail</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#xenv">xenv</a></span>) <span class="id">ls</span>' (<span class="id"><a href="compcert.backend.Cminor.html#Sseq">Sseq</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#Sblock">Sblock</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#body">body</a></span>) <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ts">ts</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h1> Stack layout </h1>
<br/>
<div class="doc">Layout of the Cminor stack data block and construction of the
  compilation environment.  Every Csharpminor local variable is
  allocated a slot in the Cminor stack data.  Sufficient padding is
  inserted to ensure adequate alignment of addresses. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="block_alignment">block_alignment</a></span> (<span class="id">sz</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#sz">sz</a></span> 2 <span class="kwd">then</span> 1<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#sz">sz</a></span> 4 <span class="kwd">then</span> 2<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#sz">sz</a></span> 8 <span class="kwd">then</span> 4 <span class="kwd">else</span> 8.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="assign_variable">assign_variable</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">cenv_stacksize</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">id_sz</span>: <span class="id"><a href="compcert.common.AST.html#ident">ident</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">id</span>, <span class="id">sz</span>) := <span class="id"><a href="compcert.cfrontend.Cminorgen.html#id_sz">id_sz</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">cenv</span>, <span class="id">stacksize</span>) := <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv_stacksize">cenv_stacksize</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ofs</span> := <span class="id"><a href="compcert.lib.Coqlib.html#align">align</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#stacksize">stacksize</a></span> (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#block_alignment">block_alignment</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#sz">sz</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;(<span class="id"><a href="compcert.lib.Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#id">id</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ofs">ofs</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span>, <span class="id"><a href="compcert.cfrontend.Cminorgen.html#ofs">ofs</a></span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> 0 <span class="id"><a href="compcert.cfrontend.Cminorgen.html#sz">sz</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="assign_variables">assign_variables</a></span> (<span class="id">cenv_stacksize</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">vars</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="compcert.common.AST.html#ident">ident</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)) : <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">List.fold_left</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#assign_variable">assign_variable</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#vars">vars</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv_stacksize">cenv_stacksize</a></span>.<br/>
<br/>
<div class="doc">Before allocating stack slots, we sort variables by increasing size
  so as to minimize padding. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="VarOrder">VarOrder</a></span> &lt;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Structures.Orders.html#TotalLeBool">TotalLeBool</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VarOrder.t">t</a></span> := (<span class="id"><a href="compcert.common.AST.html#ident">ident</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)%<span class="id">type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VarOrder.leb">leb</a></span> (<span class="id">v1</span> <span class="id">v2</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#VarOrder.t">t</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> := <span class="id"><a href="compcert.lib.Coqlib.html#zle">zle</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#v1">v1</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#v2">v2</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="VarOrder.leb_total">leb_total</a></span>: <span class="kwd">forall</span> <span class="id">v1</span> <span class="id">v2</span>, <span class="id"><a href="compcert.cfrontend.Cminorgen.html#VarOrder.leb">leb</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#v1">v1</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#v2">v2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> \/ <span class="id"><a href="compcert.cfrontend.Cminorgen.html#VarOrder.leb">leb</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#v2">v2</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#v1">v1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4848')">Proof.</div>
<div class="proofscript" id="proof4848">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#VarOrder.leb">leb</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">v1</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">v2</span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">v2</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">v1</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Coqlib.html#proj_sumbool">proj_sumbool</a></span>. <span class="tactic">destruct</span> <span class="id">H</span>; [<span class="id">left</span>|<span class="id">right</span>]; <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#zle_true">zle_true</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#VarOrder">VarOrder</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="VarSort">VarSort</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Mergesort.html#Sort">Mergesort.Sort</a></span>(<span class="id"><a href="compcert.cfrontend.Cminorgen.html#VarOrder">VarOrder</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="build_compilenv">build_compilenv</a></span> (<span class="id">f</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#function">Csharpminor.function</a></span>) : <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cfrontend.Cminorgen.html#assign_variables">assign_variables</a></span> (<span class="id"><a href="compcert.lib.Maps.html#PTree.empty">PTree.empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>, 0) (<span class="id"><a href="compcert.cfrontend.Cminorgen.html#sort">VarSort.sort</a></span> (<span class="id"><a href="compcert.cfrontend.Csharpminor.html#fn_vars">Csharpminor.fn_vars</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#f">f</a></span>)).<br/>
<br/>
<h1> Translation of functions </h1>
<br/>
<div class="doc">Translation of a Csharpminor function.  We must check that the
  required Cminor stack block is no bigger than <span class="bracket"><span class="id">Int.max_signed</span></span>,
  otherwise address computations within the stack block could
  overflow machine arithmetic and lead to incorrect code. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="transl_funbody">transl_funbody</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">cenv</span>: <span class="id"><a href="compcert.cfrontend.Cminorgen.html#compilenv">compilenv</a></span>) (<span class="id">stacksize</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">f</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#function">Csharpminor.function</a></span>): <span class="id"><a href="compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="compcert.backend.Cminor.html#function">function</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">tbody</span> &lt;- <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_stmt">transl_stmt</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#f">f</a></span>.(<span class="id"><a href="compcert.cfrontend.Csharpminor.html#fn_body">Csharpminor.fn_body</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="compcert.backend.Cminor.html#mkfunction">mkfunction</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.cfrontend.Csharpminor.html#fn_sig">Csharpminor.fn_sig</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#f">f</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.cfrontend.Csharpminor.html#fn_params">Csharpminor.fn_params</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#f">f</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.cfrontend.Csharpminor.html#fn_temps">Csharpminor.fn_temps</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#f">f</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cfrontend.Cminorgen.html#stacksize">stacksize</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cfrontend.Cminorgen.html#tbody">tbody</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="transl_function">transl_function</a></span> (<span class="id">f</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#function">Csharpminor.function</a></span>): <span class="id"><a href="compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="compcert.backend.Cminor.html#function">function</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">cenv</span>, <span class="id">stacksize</span>) := <span class="id"><a href="compcert.cfrontend.Cminorgen.html#build_compilenv">build_compilenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#f">f</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zle">zle</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#stacksize">stacksize</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_funbody">transl_funbody</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#cenv">cenv</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#stacksize">stacksize</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#f">f</a></span><br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="compcert.common.Errors.html#Error">Error</a></span>(<span class="id"><a href="compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Cminorgen</span>: <span class="id">too</span> <span class="id">many</span> <span class="id">local</span> <span class="id">variables</span>, <span class="id">stack</span> <span class="id">size</span> <span class="id">exceeded</span>").<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="transl_fundef">transl_fundef</a></span> (<span class="id">f</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#fundef">Csharpminor.fundef</a></span>): <span class="id"><a href="compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="compcert.backend.Cminor.html#fundef">fundef</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.AST.html#transf_partial_fundef">transf_partial_fundef</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_function">transl_function</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#f">f</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="transl_program">transl_program</a></span> (<span class="id">p</span>: <span class="id"><a href="compcert.cfrontend.Csharpminor.html#program">Csharpminor.program</a></span>) : <span class="id"><a href="compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="compcert.backend.Cminor.html#program">program</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.AST.html#transform_partial_program">transform_partial_program</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#transl_fundef">transl_fundef</a></span> <span class="id"><a href="compcert.cfrontend.Cminorgen.html#p">p</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
